!function(o){o.PeriodicalUpdater=function(e,t,a){function i(e){var a=jQuery.extend(!0,{},b);"function"==typeof t.data&&(a.data=t.data()),a.data&&"number"==typeof a.data&&(a.data=a.data.toString()),e||0===m?(c("Sending data"),o(function(){o.ajax(a)})):m>0&&m>f?(c("Sending data because we are at "+f+" of "+m+" calls"),o(function(){o.ajax(a)}),f++):-1==m?c("NOT sending data: stop has been called",1):c("NOT sending data: maximum number of calls reached - "+m,1)}t||(t={});var n=jQuery.extend(!0,{url:e,cache:!1,method:"GET",data:"",minTimeout:1e3,maxTimeout:64e3,multiplier:2,maxCalls:0,autoStop:0,autoStopCallback:null,cookie:!1,runatonce:!1,verbose:0},t),c=function(o,e){if(e=e||1,n.verbose>=e)try{console.log(o)}catch(t){}},r=null,u=null,l=null,s=n.minTimeout,m=n.maxCalls,d=n.autoStop,f=0,k=0,p=m,y=function(e){o(function(){null!==r&&clearTimeout(r),s=e,c("resetting timer to "+s+".",2),n.cookie&&o.cookie&&o.cookie(n.cookie.name,s,n.cookie),r=setTimeout(i,s)})},g=function(){if(n.multiplier>1){var o=s;s*=n.multiplier,s>n.maxTimeout&&(s=n.maxTimeout),c("adjusting timer from "+o+" to "+s+".",2)}y(s)};n.cookie&&("boolean"==typeof n.cookie?n.cookie={name:e}:"object"!=typeof n.cookie&&(n.cookie={name:n.cookie.toString()}),n.cookie.name||(n.cookie.name=e),o.cookie?o.cookie(n.cookie.name)&&y(o.cookie(n.cookie.name)):o.getScript("https://raw.github.com/carhartl/jquery-cookie/master/jquery.cookie.js",function(){c("Loaded the cookies handler script",2),o.cookie(n.cookie.name)?(c("Not runatonce and have cookie value",2),y(o.cookie(n.cookie.name))):(c("Not runatonce, but no cookie value",2),y(s))}).fail(function(){c("Could not load the cookies handler script",1),y(s)}));var b=jQuery.extend(!0,{},n);n.type&&!b.dataType&&(b.dataType=n.type),n.sendData&&(b.data=n.sendData),b.type=n.method,b.ifModified=!0;var T={boostTimer:function(o){o>0&&1!=o?(c("Boosting timer by a factor of "+o),s*=o):c("Cannot boost timer by a factor of "+o),y(s)},restart:function(o){c("Calling restart"),m=p,f=0,k=0,y(o||s)},send:function(){c("Explicit call to send"),i(!0)},stop:function(){c("Calling stop"),m=-1,n.cookie&&o.cookie&&o.cookie(n.cookie.name,null,n.cookie)}};return b.success=function(o){c("Successful run! (In 'success')",2),u=o},b.complete=function(e,t){if(c("Status of call: "+t+" (In 'complete')",2),"success"==t||"notmodified"==t){var i=o.trim(e.responseText);if(l==i){if(d>0&&(k++,k==d))return T.stop(),void(n.autoStopCallback&&n.autoStopCallback(k));g()}else k=0,y(n.minTimeout),l=i,n.cookie&&o.cookie(n.cookie.name,l,n.cookie),null===u&&(u=i),"json"===b.dataType&&"string"==typeof u&&"success"==t&&(u=JSON.parse(u)),n.success&&n.success(u,t,e,T),a&&a(u,t,e,T)}n.complete&&n.complete(e,t),u=null},b.error=function(e,t){c("Error message: "+t+" (In 'error')",2),"notmodified"!=t&&(l=null,n.cookie&&o.cookie(n.cookie.name,null,n.cookie),y(n.minTimeout)),n.error&&n.error(e,t)},n.runatonce?(c("Executing a call immediately",1),i(!0)):o.cookie&&o.cookie(n.cookie.name)||(c("Enqueing a the call for after "+s,1),y(s)),T},o.fn.PeriodicalUpdater=function(e,t,a){var i=this;return o.PeriodicalUpdater(e,t,function(){return a.apply(i,arguments)})}}(jQuery);