!function(e){var t={set:{colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1,focus:1},get:{selectedRegions:1,selectedMarkers:1,mapObject:1,regionName:1}};e.fn.vectorMap=function(e){var s,i,s=this.children(".jvectormap-container").data("mapObject");if("addMap"===e)jvm.WorldMap.maps[arguments[1]]=arguments[2];else{if(("set"===e||"get"===e)&&t[e][arguments[1]])return i=arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1),s[e+i].apply(s,Array.prototype.slice.call(arguments,2));e=e||{},e.container=this,s=new jvm.WorldMap(e)}return this}}(jQuery),function(e){function t(t){var s=t||window.event,i=[].slice.call(arguments,1),a=0,n=0,r=0;return t=e.event.fix(s),t.type="mousewheel",s.wheelDelta&&(a=s.wheelDelta/120),s.detail&&(a=-s.detail/3),r=a,void 0!==s.axis&&s.axis===s.HORIZONTAL_AXIS&&(r=0,n=-1*a),void 0!==s.wheelDeltaY&&(r=s.wheelDeltaY/120),void 0!==s.wheelDeltaX&&(n=-1*s.wheelDeltaX/120),i.unshift(t,a,n,r),(e.event.dispatch||e.event.handle).apply(this,i)}var s=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var i=s.length;i;)e.event.fixHooks[s[--i]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=s.length;e;)this.addEventListener(s[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=s.length;e;)this.removeEventListener(s[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery);var jvm={inherits:function(e,t){function s(){}s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.parentClass=t},mixin:function(e,t){var s;for(s in t.prototype)t.prototype.hasOwnProperty(s)&&(e.prototype[s]=t.prototype[s])},min:function(e){var t,s=Number.MAX_VALUE;if(e instanceof Array)for(t=0;t<e.length;t++)e[t]<s&&(s=e[t]);else for(t in e)e[t]<s&&(s=e[t]);return s},max:function(e){var t,s=Number.MIN_VALUE;if(e instanceof Array)for(t=0;t<e.length;t++)e[t]>s&&(s=e[t]);else for(t in e)e[t]>s&&(s=e[t]);return s},keys:function(e){var t,s=[];for(t in e)s.push(t);return s},values:function(e){var t,s,i=[];for(s=0;s<arguments.length;s++){e=arguments[s];for(t in e)i.push(e[t])}return i}};jvm.$=jQuery,jvm.AbstractElement=function(e,t){this.node=this.createElement(e),this.name=e,this.properties={},t&&this.set(t)},jvm.AbstractElement.prototype.set=function(e,t){var s;if("object"==typeof e)for(s in e)this.properties[s]=e[s],this.applyAttr(s,e[s]);else this.properties[e]=t,this.applyAttr(e,t)},jvm.AbstractElement.prototype.get=function(e){return this.properties[e]},jvm.AbstractElement.prototype.applyAttr=function(e,t){this.node.setAttribute(e,t)},jvm.AbstractElement.prototype.remove=function(){jvm.$(this.node).remove()},jvm.AbstractCanvasElement=function(e,t,s){this.container=e,this.setSize(t,s),this.rootElement=new jvm[this.classPrefix+"GroupElement"],this.node.appendChild(this.rootElement.node),this.container.appendChild(this.node)},jvm.AbstractCanvasElement.prototype.add=function(e,t){t=t||this.rootElement,t.add(e),e.canvas=this},jvm.AbstractCanvasElement.prototype.addPath=function(e,t,s){var i=new jvm[this.classPrefix+"PathElement"](e,t);return this.add(i,s),i},jvm.AbstractCanvasElement.prototype.addCircle=function(e,t,s){var i=new jvm[this.classPrefix+"CircleElement"](e,t);return this.add(i,s),i},jvm.AbstractCanvasElement.prototype.addGroup=function(e){var t=new jvm[this.classPrefix+"GroupElement"];return e?e.node.appendChild(t.node):this.node.appendChild(t.node),t.canvas=this,t},jvm.AbstractShapeElement=function(e,t,s){this.style=s||{},this.style.current={},this.isHovered=!1,this.isSelected=!1,this.updateStyle()},jvm.AbstractShapeElement.prototype.setHovered=function(e){this.isHovered!==e&&(this.isHovered=e,this.updateStyle())},jvm.AbstractShapeElement.prototype.setSelected=function(e){this.isSelected!==e&&(this.isSelected=e,this.updateStyle(),jvm.$(this.node).trigger("selected",[e]))},jvm.AbstractShapeElement.prototype.setStyle=function(e,t){var s={};"object"==typeof e?s=e:s[e]=t,jvm.$.extend(this.style.current,s),this.updateStyle()},jvm.AbstractShapeElement.prototype.updateStyle=function(){var e={};jvm.$.extend(e,this.style.initial||{}),jvm.$.extend(e,this.style.current||{}),this.isHovered&&jvm.$.extend(e,this.style.hover||{}),this.isSelected&&(jvm.$.extend(e,this.style.selected||{}),this.isHovered&&jvm.$.extend(e,this.style.selectedHover||{})),this.set(e)},jvm.SVGElement=function(){jvm.SVGElement.parentClass.apply(this,arguments)},jvm.inherits(jvm.SVGElement,jvm.AbstractElement),jvm.SVGElement.svgns="http://www.w3.org/2000/svg",jvm.SVGElement.prototype.createElement=function(e){return document.createElementNS(jvm.SVGElement.svgns,e)},jvm.SVGElement.prototype.addClass=function(e){this.node.setAttribute("class",e)},jvm.SVGElement.prototype.getElementCtr=function(e){return jvm["SVG"+e]},jvm.SVGElement.prototype.getBBox=function(){return this.node.getBBox()},jvm.SVGGroupElement=function(){jvm.SVGGroupElement.parentClass.call(this,"g")},jvm.inherits(jvm.SVGGroupElement,jvm.SVGElement),jvm.SVGGroupElement.prototype.add=function(e){this.node.appendChild(e.node)},jvm.SVGCanvasElement=function(){this.classPrefix="SVG",jvm.SVGCanvasElement.parentClass.call(this,"svg"),jvm.AbstractCanvasElement.apply(this,arguments)},jvm.inherits(jvm.SVGCanvasElement,jvm.SVGElement),jvm.mixin(jvm.SVGCanvasElement,jvm.AbstractCanvasElement),jvm.SVGCanvasElement.prototype.setSize=function(e,t){this.width=e,this.height=t,this.node.setAttribute("width",e),this.node.setAttribute("height",t)},jvm.SVGCanvasElement.prototype.applyTransformParams=function(e,t,s){this.scale=e,this.transX=t,this.transY=s,this.rootElement.node.setAttribute("transform","scale("+e+") translate("+t+", "+s+")")},jvm.SVGShapeElement=function(e,t){jvm.SVGShapeElement.parentClass.call(this,e,t),jvm.AbstractShapeElement.apply(this,arguments)},jvm.inherits(jvm.SVGShapeElement,jvm.SVGElement),jvm.mixin(jvm.SVGShapeElement,jvm.AbstractShapeElement),jvm.SVGPathElement=function(e,t){jvm.SVGPathElement.parentClass.call(this,"path",e,t),this.node.setAttribute("fill-rule","evenodd")},jvm.inherits(jvm.SVGPathElement,jvm.SVGShapeElement),jvm.SVGCircleElement=function(e,t){jvm.SVGCircleElement.parentClass.call(this,"circle",e,t)},jvm.inherits(jvm.SVGCircleElement,jvm.SVGShapeElement),jvm.VMLElement=function(){jvm.VMLElement.VMLInitialized||jvm.VMLElement.initializeVML(),jvm.VMLElement.parentClass.apply(this,arguments)},jvm.inherits(jvm.VMLElement,jvm.AbstractElement),jvm.VMLElement.VMLInitialized=!1,jvm.VMLElement.initializeVML=function(){try{document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),jvm.VMLElement.prototype.createElement=function(e){return document.createElement("<rvml:"+e+' class="rvml">')}}catch(e){jvm.VMLElement.prototype.createElement=function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"),jvm.VMLElement.VMLInitialized=!0},jvm.VMLElement.prototype.getElementCtr=function(e){return jvm["VML"+e]},jvm.VMLElement.prototype.addClass=function(e){jvm.$(this.node).addClass(e)},jvm.VMLElement.prototype.applyAttr=function(e,t){this.node[e]=t},jvm.VMLElement.prototype.getBBox=function(){var e=jvm.$(this.node);return{x:e.position().left/this.canvas.scale,y:e.position().top/this.canvas.scale,width:e.width()/this.canvas.scale,height:e.height()/this.canvas.scale}},jvm.VMLGroupElement=function(){jvm.VMLGroupElement.parentClass.call(this,"group"),this.node.style.left="0px",this.node.style.top="0px",this.node.coordorigin="0 0"},jvm.inherits(jvm.VMLGroupElement,jvm.VMLElement),jvm.VMLGroupElement.prototype.add=function(e){this.node.appendChild(e.node)},jvm.VMLCanvasElement=function(){this.classPrefix="VML",jvm.VMLCanvasElement.parentClass.call(this,"group"),jvm.AbstractCanvasElement.apply(this,arguments),this.node.style.position="absolute"},jvm.inherits(jvm.VMLCanvasElement,jvm.VMLElement),jvm.mixin(jvm.VMLCanvasElement,jvm.AbstractCanvasElement),jvm.VMLCanvasElement.prototype.setSize=function(e,t){var s,i,a,n;if(this.width=e,this.height=t,this.node.style.width=e+"px",this.node.style.height=t+"px",this.node.coordsize=e+" "+t,this.node.coordorigin="0 0",this.rootElement){for(s=this.rootElement.node.getElementsByTagName("shape"),a=0,n=s.length;n>a;a++)s[a].coordsize=e+" "+t,s[a].style.width=e+"px",s[a].style.height=t+"px";for(i=this.node.getElementsByTagName("group"),a=0,n=i.length;n>a;a++)i[a].coordsize=e+" "+t,i[a].style.width=e+"px",i[a].style.height=t+"px"}},jvm.VMLCanvasElement.prototype.applyTransformParams=function(e,t,s){this.scale=e,this.transX=t,this.transY=s,this.rootElement.node.coordorigin=this.width-t-this.width/100+","+(this.height-s-this.height/100),this.rootElement.node.coordsize=this.width/e+","+this.height/e},jvm.VMLShapeElement=function(e,t){jvm.VMLShapeElement.parentClass.call(this,e,t),this.fillElement=new jvm.VMLElement("fill"),this.strokeElement=new jvm.VMLElement("stroke"),this.node.appendChild(this.fillElement.node),this.node.appendChild(this.strokeElement.node),this.node.stroked=!1,jvm.AbstractShapeElement.apply(this,arguments)},jvm.inherits(jvm.VMLShapeElement,jvm.VMLElement),jvm.mixin(jvm.VMLShapeElement,jvm.AbstractShapeElement),jvm.VMLShapeElement.prototype.applyAttr=function(e,t){switch(e){case"fill":this.node.fillcolor=t;break;case"fill-opacity":this.fillElement.node.opacity=Math.round(100*t)+"%";break;case"stroke":"none"===t?this.node.stroked=!1:this.node.stroked=!0,this.node.strokecolor=t;break;case"stroke-opacity":this.strokeElement.node.opacity=Math.round(100*t)+"%";break;case"stroke-width":0===parseInt(t,10)?this.node.stroked=!1:this.node.stroked=!0,this.node.strokeweight=t;break;case"d":this.node.path=jvm.VMLPathElement.pathSvgToVml(t);break;default:jvm.VMLShapeElement.parentClass.prototype.applyAttr.apply(this,arguments)}},jvm.VMLPathElement=function(e,t){var s=new jvm.VMLElement("skew");jvm.VMLPathElement.parentClass.call(this,"shape",e,t),this.node.coordorigin="0 0",s.node.on=!0,s.node.matrix="0.01,0,0,0.01,0,0",s.node.offset="0,0",this.node.appendChild(s.node)},jvm.inherits(jvm.VMLPathElement,jvm.VMLShapeElement),jvm.VMLPathElement.prototype.applyAttr=function(e,t){"d"===e?this.node.path=jvm.VMLPathElement.pathSvgToVml(t):jvm.VMLShapeElement.prototype.applyAttr.call(this,e,t)},jvm.VMLPathElement.pathSvgToVml=function(e){var t,s,i=0,a=0;return e=e.replace(/(-?\d+)e(-?\d+)/g,"0"),e.replace(/([MmLlHhVvCcSs])\s*((?:-?\d*(?:\.\d+)?\s*,?\s*)+)/g,function(e,n,r){r=r.replace(/(\d)-/g,"$1,-").replace(/^\s+/g,"").replace(/\s+$/g,"").replace(/\s+/g,",").split(","),r[0]||r.shift();for(var o=0,l=r.length;l>o;o++)r[o]=Math.round(100*r[o]);switch(n){case"m":return i+=r[0],a+=r[1],"t"+r.join(",");case"M":return i=r[0],a=r[1],"m"+r.join(",");case"l":return i+=r[0],a+=r[1],"r"+r.join(",");case"L":return i=r[0],a=r[1],"l"+r.join(",");case"h":return i+=r[0],"r"+r[0]+",0";case"H":return i=r[0],"l"+i+","+a;case"v":return a+=r[0],"r0,"+r[0];case"V":return a=r[0],"l"+i+","+a;case"c":return t=i+r[r.length-4],s=a+r[r.length-3],i+=r[r.length-2],a+=r[r.length-1],"v"+r.join(",");case"C":return t=r[r.length-4],s=r[r.length-3],i=r[r.length-2],a=r[r.length-1],"c"+r.join(",");case"s":return r.unshift(a-s),r.unshift(i-t),t=i+r[r.length-4],s=a+r[r.length-3],i+=r[r.length-2],a+=r[r.length-1],"v"+r.join(",");case"S":return r.unshift(a+a-s),r.unshift(i+i-t),t=r[r.length-4],s=r[r.length-3],i=r[r.length-2],a=r[r.length-1],"c"+r.join(",")}return""}).replace(/z/g,"e")},jvm.VMLCircleElement=function(e,t){jvm.VMLCircleElement.parentClass.call(this,"oval",e,t)},jvm.inherits(jvm.VMLCircleElement,jvm.VMLShapeElement),jvm.VMLCircleElement.prototype.applyAttr=function(e,t){switch(e){case"r":this.node.style.width=2*t+"px",this.node.style.height=2*t+"px",this.applyAttr("cx",this.get("cx")||0),this.applyAttr("cy",this.get("cy")||0);break;case"cx":if(!t)return;this.node.style.left=t-(this.get("r")||0)+"px";break;case"cy":if(!t)return;this.node.style.top=t-(this.get("r")||0)+"px";break;default:jvm.VMLCircleElement.parentClass.prototype.applyAttr.call(this,e,t)}},jvm.VectorCanvas=function(e,t,s){return this.mode=window.SVGAngle?"svg":"vml","svg"==this.mode?this.impl=new jvm.SVGCanvasElement(e,t,s):this.impl=new jvm.VMLCanvasElement(e,t,s),this.impl},jvm.SimpleScale=function(e){this.scale=e},jvm.SimpleScale.prototype.getValue=function(e){return e},jvm.OrdinalScale=function(e){this.scale=e},jvm.OrdinalScale.prototype.getValue=function(e){return this.scale[e]},jvm.NumericScale=function(e,t,s,i){this.scale=[],t=t||"linear",e&&this.setScale(e),t&&this.setNormalizeFunction(t),s&&this.setMin(s),i&&this.setMax(i)},jvm.NumericScale.prototype={setMin:function(e){this.clearMinValue=e,"function"==typeof this.normalize?this.minValue=this.normalize(e):this.minValue=e},setMax:function(e){this.clearMaxValue=e,"function"==typeof this.normalize?this.maxValue=this.normalize(e):this.maxValue=e},setScale:function(e){var t;for(t=0;t<e.length;t++)this.scale[t]=[e[t]]},setNormalizeFunction:function(e){"polynomial"===e?this.normalize=function(e){return Math.pow(e,.2)}:"linear"===e?delete this.normalize:this.normalize=e,this.setMin(this.clearMinValue),this.setMax(this.clearMaxValue)},getValue:function(e){var t,s,i=[],a=0,n=0;for("function"==typeof this.normalize&&(e=this.normalize(e)),n=0;n<this.scale.length-1;n++)t=this.vectorLength(this.vectorSubtract(this.scale[n+1],this.scale[n])),i.push(t),a+=t;for(s=(this.maxValue-this.minValue)/a,n=0;n<i.length;n++)i[n]*=s;for(n=0,e-=this.minValue;e-i[n]>=0;)e-=i[n],n++;return e=n==this.scale.length-1?this.vectorToNum(this.scale[n]):this.vectorToNum(this.vectorAdd(this.scale[n],this.vectorMult(this.vectorSubtract(this.scale[n+1],this.scale[n]),e/i[n])))},vectorToNum:function(e){var t,s=0;for(t=0;t<e.length;t++)s+=Math.round(e[t])*Math.pow(256,e.length-t-1);return s},vectorSubtract:function(e,t){var s,i=[];for(s=0;s<e.length;s++)i[s]=e[s]-t[s];return i},vectorAdd:function(e,t){var s,i=[];for(s=0;s<e.length;s++)i[s]=e[s]+t[s];return i},vectorMult:function(e,t){var s,i=[];for(s=0;s<e.length;s++)i[s]=e[s]*t;return i},vectorLength:function(e){var t,s=0;for(t=0;t<e.length;t++)s+=e[t]*e[t];return Math.sqrt(s)}},jvm.ColorScale=function(){jvm.ColorScale.parentClass.apply(this,arguments)},jvm.inherits(jvm.ColorScale,jvm.NumericScale),jvm.ColorScale.prototype.setScale=function(e){var t;for(t=0;t<e.length;t++)this.scale[t]=jvm.ColorScale.rgbToArray(e[t])},jvm.ColorScale.prototype.getValue=function(e){return jvm.ColorScale.numToRgb(jvm.ColorScale.parentClass.prototype.getValue.call(this,e))},jvm.ColorScale.arrayToRgb=function(e){var t,s,i="#";for(s=0;s<e.length;s++)t=e[s].toString(16),i+=1==t.length?"0"+t:t;return i},jvm.ColorScale.numToRgb=function(e){for(e=e.toString(16);e.length<6;)e="0"+e;return"#"+e},jvm.ColorScale.rgbToArray=function(e){return e=e.substr(1),[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)]},jvm.DataSeries=function(e,t){var s;e=e||{},e.attribute=e.attribute||"fill",this.elements=t,this.params=e,e.attributes&&this.setAttributes(e.attributes),jvm.$.isArray(e.scale)?(s="fill"===e.attribute||"stroke"===e.attribute?jvm.ColorScale:jvm.NumericScale,this.scale=new s(e.scale,e.normalizeFunction,e.min,e.max)):e.scale?this.scale=new jvm.OrdinalScale(e.scale):this.scale=new jvm.SimpleScale(e.scale),e.values&&(this.values=e.values||{},this.setValues(e.values))},jvm.DataSeries.prototype={setAttributes:function(e,t){var s,i=e;if("string"==typeof e)this.elements[e]&&this.elements[e].setStyle(this.params.attribute,t);else for(s in i)this.elements[s]&&this.elements[s].element.setStyle(this.params.attribute,i[s])},setValues:function(e){var t,s,i=Number.MIN_VALUE,a=Number.MAX_VALUE,n={};if(this.scale instanceof jvm.OrdinalScale||this.scale instanceof jvm.SimpleScale)for(s in e)e[s]?n[s]=this.scale.getValue(e[s]):n[s]=this.elements[s].element.style.initial[this.params.attribute];else{if(!this.params.min||!this.params.max){for(s in e)t=parseFloat(e[s]),t>i&&(i=e[s]),a>t&&(a=t);this.params.min||this.scale.setMin(a),this.params.max||this.scale.setMax(i),this.params.min=a,this.params.max=i}for(s in e)t=parseFloat(e[s]),isNaN(t)?n[s]=this.elements[s].element.style.initial[this.params.attribute]:n[s]=this.scale.getValue(t)}this.setAttributes(n),$.extend(this.values,e)},clear:function(){var e,t={};for(e in this.values)t[e]=this.elements[e].element.style.initial[this.params.attribute];this.setAttributes(t),this.values={}},setScale:function(e){this.scale.setScale(e),this.values&&this.setValues(this.values)},setNormalizeFunction:function(e){this.scale.setNormalizeFunction(e),this.values&&this.setValues(this.values)}},jvm.Proj={mill:function(e,t,s){return{x:(t-s)/360*jvm.WorldMap.circumference,y:-(180/Math.PI*(5/4)*Math.log(Math.tan(Math.PI/4+.8*e*Math.PI/360)))/360*jvm.WorldMap.circumference}},merc:function(e,t,s){return{x:(t-s)/360*jvm.WorldMap.circumference,y:-(180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360*jvm.WorldMap.circumference}},aea:function(e,t,s){var i=0,a=s/180*Math.PI,n=29.5/180*Math.PI,r=45.5/180*Math.PI,o=e/180*Math.PI,l=t/180*Math.PI,h=(Math.sin(n)+Math.sin(r))/2,c=Math.cos(n)*Math.cos(n)+2*h*Math.sin(n),m=h*(l-a),p=Math.sqrt(c-2*h*Math.sin(o))/h,v=Math.sqrt(c-2*h*Math.sin(i))/h;return{x:p*Math.sin(m)/(2*Math.PI)*jvm.WorldMap.circumference,y:-(v-p*Math.cos(m))/(2*Math.PI)*jvm.WorldMap.circumference}},lcc:function(e,t,s){var i=0,a=s/180*Math.PI,r=t/180*Math.PI,o=33/180*Math.PI,l=.25*Math.PI,h=e/180*Math.PI;return n=Math.log(Math.cos(o)*(1/Math.cos(l)))/Math.log(Math.tan(Math.PI/4+l/2)*(1/Math.tan(Math.PI/4+o/2))),F=Math.cos(o)*Math.pow(Math.tan(Math.PI/4+o/2),n)/n,ro=F*Math.pow(1/Math.tan(Math.PI/4+h/2),n),ro0=F*Math.pow(1/Math.tan(Math.PI/4+i/2),n),{x:ro*Math.sin(n*(r-a))/(2*Math.PI)*jvm.WorldMap.circumference,y:-(ro0-ro*Math.cos(n*(r-a)))/(2*Math.PI)*jvm.WorldMap.circumference}}},jvm.WorldMap=function(e){var t,s=this;this.params=jvm.$.extend(!0,{},jvm.WorldMap.defaultParams,e),this.mapData=jvm.WorldMap.maps[this.params.map],this.markers={},this.regions={},this.regionsColors={},this.regionsData={},this.container=jvm.$("<div>").css({width:"100%",height:"100%"}).addClass("jvectormap-container"),this.params.container.append(this.container),this.container.data("mapObject",this),this.container.css({position:"relative",overflow:"hidden"}),this.defaultWidth=this.mapData.width,this.defaultHeight=this.mapData.height,this.setBackgroundColor(this.params.backgroundColor),this.onResize=function(){s.setSize()},jvm.$(window).resize(this.onResize);for(t in jvm.WorldMap.apiEvents)this.params[t]&&this.container.bind(jvm.WorldMap.apiEvents[t]+".jvectormap",this.params[t]);this.canvas=new jvm.VectorCanvas(this.container[0],this.width,this.height),"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?this.params.bindTouchEvents&&this.bindContainerTouchEvents():this.bindContainerEvents(),this.bindElementEvents(),this.createLabel(),this.bindZoomButtons(),this.createRegions(),this.createMarkers(this.params.markers||{}),this.setSize(),this.params.focusOn&&("object"==typeof this.params.focusOn?this.setFocus.call(this,this.params.focusOn.scale,this.params.focusOn.x,this.params.focusOn.y):this.setFocus.call(this,this.params.focusOn)),this.params.selectedRegions&&this.setSelectedRegions(this.params.selectedRegions),this.params.selectedMarkers&&this.setSelectedMarkers(this.params.selectedMarkers),this.params.series&&this.createSeries()},jvm.WorldMap.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,setBackgroundColor:function(e){this.container.css("background-color",e)},resize:function(){var e=this.baseScale;this.width/this.height>this.defaultWidth/this.defaultHeight?(this.baseScale=this.height/this.defaultHeight,this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)):(this.baseScale=this.width/this.defaultWidth,this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale)),this.scale*=this.baseScale/e,this.transX*=this.baseScale/e,this.transY*=this.baseScale/e},setSize:function(){this.width=this.container.width(),this.height=this.container.height(),this.resize(),this.canvas.setSize(this.width,this.height),this.applyTransform()},reset:function(){var e,t;for(e in this.series)for(t=0;t<this.series[e].length;t++)this.series[e][t].clear();this.scale=this.baseScale,this.transX=this.baseTransX,this.transY=this.baseTransY,this.applyTransform()},applyTransform:function(){var e,t,s,i;this.defaultWidth*this.scale<=this.width?(e=(this.width-this.defaultWidth*this.scale)/(2*this.scale),s=(this.width-this.defaultWidth*this.scale)/(2*this.scale)):(e=0,s=(this.width-this.defaultWidth*this.scale)/this.scale),this.defaultHeight*this.scale<=this.height?(t=(this.height-this.defaultHeight*this.scale)/(2*this.scale),i=(this.height-this.defaultHeight*this.scale)/(2*this.scale)):(t=0,i=(this.height-this.defaultHeight*this.scale)/this.scale),this.transY>t?this.transY=t:this.transY<i&&(this.transY=i),this.transX>e?this.transX=e:this.transX<s&&(this.transX=s),this.canvas.applyTransformParams(this.scale,this.transX,this.transY),this.markers&&this.repositionMarkers()},bindContainerEvents:function(){var e,t,s=!1,i=this;this.container.mousemove(function(a){return s&&(i.transX-=(e-a.pageX)/i.scale,i.transY-=(t-a.pageY)/i.scale,i.applyTransform(),e=a.pageX,t=a.pageY),!1}).mousedown(function(i){return s=!0,e=i.pageX,t=i.pageY,!1}),jvm.$("body").mouseup(function(){s=!1}),this.params.zoomOnScroll&&this.container.mousewheel(function(e,t,s,a){var n=jvm.$(i.container).offset(),r=e.pageX-n.left,o=e.pageY-n.top,l=Math.pow(1.3,a);i.label.hide(),i.setScale(i.scale*l,r,o),e.preventDefault()})},bindContainerTouchEvents:function(){var e,t,s,i,a,n,r,o=this;jvm.$(this.container).bind("gesturestart",function(){return e=o.scale,t=o.transX,s=o.transY,!1}),jvm.$(this.container).bind("gesturechange",function(t){var s=t.originalEvent.scale;return o.setScale(e*s,n,r),o.label.hide(),!1}),jvm.$(this.container).bind("touchstart",function(e){var t=e.originalEvent.touches;2==t.length&&(n=t[0].pageX>t[1].pageX?t[1].pageX+(t[0].pageX-t[1].pageX)/2:t[0].pageX+(t[1].pageX-t[0].pageX)/2,r=t[0].pageY>t[1].pageY?t[1].pageY+(t[0].pageY-t[1].pageY)/2:t[0].pageY+(t[1].pageY-t[0].pageY)/2),i=e.originalEvent.touches[0].pageX,a=e.originalEvent.touches[0].pageY}),jvm.$(this.container).bind("touchmove",function(e){var t;return o.scale!=o.baseScale?(1==e.originalEvent.touches.length&&i&&a?(t=e.originalEvent.touches[0],o.transX-=(i-t.pageX)/o.scale,o.transY-=(a-t.pageY)/o.scale,o.applyTransform(),o.label.hide(),i=t.pageX,a=t.pageY):(i=!1,a=!1),!1):void 0})},bindElementEvents:function(){var e,t=this;this.container.mousemove(function(){e=!0}),this.container.delegate("[class~='jvectormap-element']","mouseover mouseout",function(e){var s=-1===jvm.$(this).attr("class").indexOf("jvectormap-region")?"marker":"region",i="region"==s?jvm.$(this).attr("data-code"):jvm.$(this).attr("data-index"),a="region"==s?t.regions[i].element:t.markers[i].element,n="region"==s?t.mapData.paths[i].name:t.markers[i].config.name||"",r=jvm.$.Event(s+"LabelShow.jvectormap"),o=jvm.$.Event(s+"Over.jvectormap");"mouseover"==e.type?(t.container.trigger(o,[i]),o.isDefaultPrevented()||a.setHovered(!0),t.label.text(n),t.container.trigger(r,[t.label,i]),r.isDefaultPrevented()||(t.label.show(),t.labelWidth=t.label.width(),t.labelHeight=t.label.height())):(a.setHovered(!1),t.label.hide(),t.container.trigger(s+"Out.jvectormap",[i]))}),this.container.delegate("[class~='jvectormap-element']","mousedown",function(){e=!1}),this.container.delegate("[class~='jvectormap-element']","mouseup",function(){var s=-1===jvm.$(this).attr("class").indexOf("jvectormap-region")?"marker":"region",i="region"==s?jvm.$(this).attr("data-code"):jvm.$(this).attr("data-index"),a=jvm.$.Event(s+"Click.jvectormap"),n="region"==s?t.regions[i].element:t.markers[i].element;e||(t.container.trigger(a,[i]),("region"===s&&t.params.regionsSelectable||"marker"===s&&t.params.markersSelectable)&&(a.isDefaultPrevented()||(t.params[s+"sSelectableOne"]&&t.clearSelected(s+"s"),n.setSelected(!n.isSelected))))})},bindZoomButtons:function(){var e=this;jvm.$("<div/>").addClass("jvectormap-zoomin").text("+").appendTo(this.container),jvm.$("<div/>").addClass("jvectormap-zoomout").html("&#x2212;").appendTo(this.container),this.container.find(".jvectormap-zoomin").click(function(){e.setScale(e.scale*e.params.zoomStep,e.width/2,e.height/2)}),this.container.find(".jvectormap-zoomout").click(function(){e.setScale(e.scale/e.params.zoomStep,e.width/2,e.height/2)})},createLabel:function(){var e=this;this.label=jvm.$("<div/>").addClass("jvectormap-label").appendTo(jvm.$("body")),this.container.mousemove(function(t){var s=t.pageX-15-e.labelWidth,i=t.pageY-15-e.labelHeight;5>s&&(s=t.pageX+15),5>i&&(i=t.pageY+15),e.label.is(":visible")&&e.label.css({left:s,top:i})})},setScale:function(e,t,s,i){var a,n=jvm.$.Event("zoom.jvectormap");e>this.params.zoomMax*this.baseScale?e=this.params.zoomMax*this.baseScale:e<this.params.zoomMin*this.baseScale&&(e=this.params.zoomMin*this.baseScale),"undefined"!=typeof t&&"undefined"!=typeof s&&(a=e/this.scale,i?(this.transX=t+this.defaultWidth*(this.width/(this.defaultWidth*e))/2,this.transY=s+this.defaultHeight*(this.height/(this.defaultHeight*e))/2):(this.transX-=(a-1)/e*t,this.transY-=(a-1)/e*s)),this.scale=e,this.applyTransform(),this.container.trigger(n,[e/this.baseScale])},setFocus:function(e,t,s){var i;"string"==typeof e&&this.regions[e]?(i=this.regions[e].element.getBBox(),this.setScale(Math.min(this.width/i.width,this.height/i.height),-(i.x+i.width/2),-(i.y+i.height/2),!0)):this.setScale(e,-t*this.defaultWidth,-s*this.defaultHeight,!0)},getSelected:function(e){var t,s=[];for(t in this[e])this[e][t].element.isSelected&&s.push(t);return s},getSelectedRegions:function(){return this.getSelected("regions")},getSelectedMarkers:function(){return this.getSelected("markers")},setSelected:function(e,t){var s;if("object"!=typeof t&&(t=[t]),jvm.$.isArray(t))for(s=0;s<t.length;s++)this[e][t[s]].element.setSelected(!0);else for(s in t)this[e][s].element.setSelected(!!t[s])},setSelectedRegions:function(e){this.setSelected("regions",e)},setSelectedMarkers:function(e){this.setSelected("markers",e)},clearSelected:function(e){var t,s={},i=this.getSelected(e);for(t=0;t<i.length;t++)s[i[t]]=!1;this.setSelected(e,s)},clearSelectedRegions:function(){this.clearSelected("regions")},clearSelectedMarkers:function(){this.clearSelected("markers")},getMapObject:function(){return this},getRegionName:function(e){return this.mapData.paths[e].name},createRegions:function(){var e,t,s=this;for(e in this.mapData.paths)t=this.canvas.addPath({d:this.mapData.paths[e].path,"data-code":e},jvm.$.extend(!0,{},this.params.regionStyle)),jvm.$(t.node).bind("selected",function(e,t){s.container.trigger("regionSelected.jvectormap",[jvm.$(this).attr("data-code"),t,s.getSelectedRegions()])}),t.addClass("jvectormap-region jvectormap-element"),this.regions[e]={element:t,config:this.mapData.paths[e]}},createMarkers:function(e){var t,s,i,a,n,r=this;if(this.markersGroup=this.markersGroup||this.canvas.addGroup(),jvm.$.isArray(e))for(n=e.slice(),e={},t=0;t<n.length;t++)e[t]=n[t];for(t in e)a=e[t]instanceof Array?{latLng:e[t]}:e[t],i=this.latLngToPoint.apply(this,a.latLng||[0,0]),s=this.canvas.addCircle({"data-index":t,cx:i.x,cy:i.y},jvm.$.extend(!0,{},this.params.markerStyle,{initial:a.style||{}}),this.markersGroup),s.addClass("jvectormap-marker jvectormap-element"),jvm.$(s.node).bind("selected",function(e,t){r.container.trigger("markerSelected.jvectormap",[jvm.$(this).attr("data-index"),t,r.getSelectedMarkers()])}),this.markers[t]&&this.removeMarkers([t]),this.markers[t]={element:s,config:a}},repositionMarkers:function(){var e,t;for(e in this.markers)t=this.latLngToPoint.apply(this,this.markers[e].config.latLng),this.markers[e].element.setStyle({cx:t.x,cy:t.y})},addMarker:function(e,t,s){var i,a,n={},r=[];for(n[e]=t,a=0;a<s.length;a++)i={},i[e]=s[a],r.push(i);this.addMarkers(n,r)},addMarkers:function(e,t){var s;for(t=t||[],this.createMarkers(e),s=0;s<t.length;s++)this.series.markers[s].setValues(t[s]||{})},removeMarkers:function(e){var t;for(t=0;t<e.length;t++)this.markers[e[t]].element.remove(),delete this.markers[e[t]]},removeAllMarkers:function(){var e,t=[];for(e in this.markers)t.push(e);this.removeMarkers(t)},latLngToPoint:function(e,t){var s,i,a,n=jvm.WorldMap.maps[this.params.map].projection,r=n.centralMeridian;this.width-2*this.baseTransX*this.baseScale,this.height-2*this.baseTransY*this.baseScale,this.scale/this.baseScale;return-180+r>t&&(t+=360),s=jvm.Proj[n.type](e,t,r),i=this.getInsetForPoint(s.x,s.y),i?(a=i.bbox,s.x=(s.x-a[0].x)/(a[1].x-a[0].x)*i.width*this.scale,s.y=(s.y-a[0].y)/(a[1].y-a[0].y)*i.height*this.scale,{x:s.x+this.transX*this.scale+i.left*this.scale,y:s.y+this.transY*this.scale+i.top*this.scale}):{x:0,y:0}},getInsetForPoint:function(e,t){var s,i,a=jvm.WorldMap.maps[this.params.map].insets;for(s=0;s<a.length;s++)if(i=a[s].bbox,e>i[0].x&&e<i[1].x&&t>i[0].y&&t<i[1].y)return a[s]},createSeries:function(){var e,t;this.series={markers:[],regions:[]};for(t in this.params.series)for(e=0;e<this.params.series[t].length;e++)this.series[t][e]=new jvm.DataSeries(this.params.series[t][e],this[t])},remove:function(){this.label.remove(),this.container.remove(),jvm.$(window).unbind("resize",this.onResize)}},jvm.WorldMap.maps={},jvm.WorldMap.circumference=6381372*Math.PI*2,jvm.WorldMap.defaultParams={map:"world_mill_en",backgroundColor:"#505050",zoomOnScroll:!0,zoomMax:8,zoomMin:1,zoomStep:1.6,regionsSelectable:!1,markersSelectable:!1,bindTouchEvents:!0,regionStyle:{initial:{fill:"white","fill-opacity":1,stroke:"none","stroke-width":0,"stroke-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"yellow"},selectedHover:{}},markerStyle:{initial:{fill:"grey",stroke:"#505050","fill-opacity":1,"stroke-width":1,"stroke-opacity":1,r:5},hover:{stroke:"black","stroke-width":2},selected:{fill:"blue"},selectedHover:{}}},jvm.WorldMap.apiEvents={onRegionLabelShow:"regionLabelShow",onRegionOver:"regionOver",onRegionOut:"regionOut",onRegionClick:"regionClick",onRegionSelected:"regionSelected",onMarkerLabelShow:"markerLabelShow",onMarkerOver:"markerOver",onMarkerOut:"markerOut",onMarkerClick:"markerClick",onMarkerSelected:"markerSelected",onZoom:"zoom"};