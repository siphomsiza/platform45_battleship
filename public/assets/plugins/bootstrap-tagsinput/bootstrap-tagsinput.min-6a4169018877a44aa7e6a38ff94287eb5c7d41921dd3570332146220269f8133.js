!function(m){"use strict";function o(t,e){this.itemsArray=[],this.$element=m(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=e&&e.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=m('<div class="bootstrap-tagsinput"></div>'),this.$input=m('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container),this.build(e)}function e(t,e){if("function"!=typeof t[e]){var n=t[e];t[e]=function(t){return t[n]}}}function n(t,e){if("function"!=typeof t[e]){var n=t[e];t[e]=function(){return n}}}function h(t){return t?i.text(t).html():""}function u(t){var e=0;if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e}var a={tagClass:function(){return"label label-info"},itemValue:function(t){return t?t.toString():t},itemText:function(t){return this.itemValue(t)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(t,e){e.hide().fadeIn()}};o.prototype={constructor:o,add:function(t,e){var n=this;if(!(n.options.maxTags&&n.itemsArray.length>=n.options.maxTags||!1!==t&&!t)){if("object"==typeof t&&!n.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(n.isSelect&&!n.multiple&&0<n.itemsArray.length&&n.remove(n.itemsArray[0]),"string"==typeof t&&"INPUT"===this.$element[0].tagName){var i=t.split(",");if(1<i.length){for(var a=0;a<i.length;a++)this.add(i[a],!0);return void(e||n.pushVal())}}var o=n.options.itemValue(t),r=n.options.itemText(t),s=n.options.tagClass(t),u=m.grep(n.itemsArray,function(t){return n.options.itemValue(t)===o})[0];if(u){if(n.options.onTagExists){var c=m(".tag",n.$container).filter(function(){return m(this).data("item")===u});n.options.onTagExists(t,c)}}else{n.itemsArray.push(t);var l=m('<span class="tag '+h(s)+'">'+h(r)+'<span data-role="remove"></span></span>');if(l.data("item",t),n.findInputWrapper().before(l),l.after(" "),n.isSelect&&!m('option[value="'+escape(o)+'"]',n.$element)[0]){var p=m("<option selected>"+h(r)+"</option>");p.data("item",t),p.attr("value",o),n.$element.append(p)}e||n.pushVal(),n.options.maxTags===n.itemsArray.length&&n.$container.addClass("bootstrap-tagsinput-max"),n.$element.trigger(m.Event("itemAdded",{item:t}))}}}},remove:function(e,t){var n=this;n.objectItems&&(e="object"==typeof e?m.grep(n.itemsArray,function(t){return n.options.itemValue(t)==n.options.itemValue(e)})[0]:m.grep(n.itemsArray,function(t){return n.options.itemValue(t)==e})[0]),e&&(m(".tag",n.$container).filter(function(){return m(this).data("item")===e}).remove(),m("option",n.$element).filter(function(){return m(this).data("item")===e}).remove(),n.itemsArray.splice(m.inArray(e,n.itemsArray),1)),t||n.pushVal(),n.options.maxTags>n.itemsArray.length&&n.$container.removeClass("bootstrap-tagsinput-max"),n.$element.trigger(m.Event("itemRemoved",{item:e}))},removeAll:function(){var t=this;for(m(".tag",t.$container).remove(),m("option",t.$element).remove();0<t.itemsArray.length;)t.itemsArray.pop();t.pushVal(),t.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var o=this;m(".tag",o.$container).each(function(){var t=m(this),e=t.data("item"),n=o.options.itemValue(e),i=o.options.itemText(e),a=o.options.tagClass(e);(t.attr("class",null),t.addClass("tag "+h(a)),t.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=h(i),o.isSelect)&&m("option",o.$element).filter(function(){return m(this).data("item")===e}).attr("value",n)})},items:function(){return this.itemsArray},pushVal:function(){var e=this,t=m.map(e.items(),function(t){return e.options.itemValue(t).toString()});e.$element.val(t,!0).trigger("change")},build:function(t){var s=this;s.options=m.extend({},a,t);var i=s.options.typeahead||{};s.objectItems&&(s.options.freeInput=!1),e(s.options,"itemValue"),e(s.options,"itemText"),e(s.options,"tagClass"),s.options.source&&(i.source=s.options.source),i.source&&m.fn.typeahead&&(n(i,"source"),s.$input.typeahead({source:function(t,a){function e(t){for(var e=[],n=0;n<t.length;n++){var i=s.options.itemText(t[n]);o[i]=t[n],e.push(i)}a(e)}this.map={};var o=this.map,n=i.source(t);m.isFunction(n.success)?n.success(e):m.when(n).then(e)},updater:function(t){s.add(this.map[t])},matcher:function(t){return-1!==t.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(t){return t.sort()},highlighter:function(t){var e=new RegExp("("+this.query+")","gi");return t.replace(e,"<strong>$1</strong>")}})),s.$container.on("click",m.proxy(function(){s.$input.focus()},s)),s.$container.on("keydown","input",m.proxy(function(t){var e=m(t.target),n=s.findInputWrapper();switch(t.which){case 8:if(0===u(e[0])){var i=n.prev();i&&s.remove(i.data("item"))}break;case 46:if(0===u(e[0])){var a=n.next();a&&s.remove(a.data("item"))}break;case 37:var o=n.prev();0===e.val().length&&o[0]&&(o.before(n),e.focus());break;case 39:var r=n.next();0===e.val().length&&r[0]&&(r.after(n),e.focus());break;default:s.options.freeInput&&0<=m.inArray(t.which,s.options.confirmKeys)&&(s.add(e.val()),e.val(""),t.preventDefault())}e.attr("size",Math.max(this.inputSize,e.val().length))},s)),s.$container.on("click","[data-role=remove]",m.proxy(function(t){s.remove(m(t.target).closest(".tag").data("item"))},s)),s.options.itemValue===a.itemValue&&("INPUT"===s.$element[0].tagName?s.add(s.$element.val()):m("option",s.$element).each(function(){s.add(m(this).attr("value"),!0)}))},destroy:function(){var t=this;t.$container.off("keypress","input"),t.$container.off("click","[role=remove]"),t.$container.remove(),t.$element.removeData("tagsinput"),t.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],e=this.$container[0];t&&t.parentNode!==e;)t=t.parentNode;return m(t)}},m.fn.tagsinput=function(n,i){var a=[];return this.each(function(){var t=m(this).data("tagsinput");if(t){var e=t[n](i);void 0!==e&&a.push(e)}else t=new o(this,n),m(this).data("tagsinput",t),a.push(t),"SELECT"===this.tagName&&m("option",m(this)).attr("selected","selected"),m(this).val(m(this).val())}),"string"==typeof n?1<a.length?a:a[0]:a},m.fn.tagsinput.Constructor=o;var i=m("<div />");m(function(){m("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);