!function(x){function e(a){function n(e){g.active&&(l(e),a.getPlaceholder().trigger("plotselecting",[i()]))}function o(e){1==e.which&&(document.body.focus(),document.onselectstart!==undefined&&null==h.onselectstart&&(h.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),document.ondrag!==undefined&&null==h.ondrag&&(h.ondrag=document.ondrag,document.ondrag=function(){return!1}),c(g.first,e),g.active=!0,m=function(e){t(e)},x(document).one("mouseup",m))}function t(e){return m=null,document.onselectstart!==undefined&&(document.onselectstart=h.onselectstart),document.ondrag!==undefined&&(document.ondrag=h.ondrag),g.active=!1,l(e),f()?s():(a.getPlaceholder().trigger("plotunselected",[]),a.getPlaceholder().trigger("plotselecting",[null])),!1}function i(){if(!f())return null;if(!g.show)return null;var i={},s=g.first,r=g.second;return x.each(a.getAxes(),function(e,t){if(t.used){var n=t.c2p(s[t.direction]),o=t.c2p(r[t.direction]);i[e]={from:Math.min(n,o),to:Math.max(n,o)}}}),i}function s(){var e=i();a.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&a.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function r(e,t,n){return t<e?e:n<t?n:t}function c(e,t){var n=a.getOptions(),o=a.getPlaceholder().offset(),i=a.getPlotOffset();e.x=r(0,t.pageX-o.left-i.left,a.width()),e.y=r(0,t.pageY-o.top-i.top,a.height()),"y"==n.selection.mode&&(e.x=e==g.first?0:a.width()),"x"==n.selection.mode&&(e.y=e==g.first?0:a.height())}function l(e){null!=e.pageX&&(c(g.second,e),f()?(g.show=!0,a.triggerRedrawOverlay()):u(!0))}function u(e){g.show&&(g.show=!1,a.triggerRedrawOverlay(),e||a.getPlaceholder().trigger("plotunselected",[]))}function d(e,t){var n,o,i,s,r=a.getAxes();for(var c in r)if((n=r[c]).direction==t&&(e[s=t+n.n+"axis"]||1!=n.n||(s=t+"axis"),e[s])){o=e[s].from,i=e[s].to;break}if(e[s]||(n="x"==t?a.getXAxes()[0]:a.getYAxes()[0],o=e[t+"1"],i=e[t+"2"]),null!=o&&null!=i&&i<o){var l=o;o=i,i=l}return{from:o,to:i,axis:n}}function e(e,t){var n,o=a.getOptions();"y"==o.selection.mode?(g.first.x=0,g.second.x=a.width()):(n=d(e,"x"),g.first.x=n.axis.p2c(n.from),g.second.x=n.axis.p2c(n.to)),"x"==o.selection.mode?(g.first.y=0,g.second.y=a.height()):(n=d(e,"y"),g.first.y=n.axis.p2c(n.from),g.second.y=n.axis.p2c(n.to)),g.show=!0,a.triggerRedrawOverlay(),!t&&f()&&s()}function f(){var e=a.getOptions().selection.minSize;return Math.abs(g.second.x-g.first.x)>=e&&Math.abs(g.second.y-g.first.y)>=e}var g={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},h={},m=null;a.clearSelection=u,a.setSelection=e,a.getSelection=i,a.hooks.bindEvents.push(function(e,t){null!=e.getOptions().selection.mode&&(t.mousemove(n),t.mousedown(o))}),a.hooks.drawOverlay.push(function(e,t){if(g.show&&f()){var n=e.getPlotOffset(),o=e.getOptions();t.save(),t.translate(n.left,n.top);var i=x.color.parse(o.selection.color);t.strokeStyle=i.scale("a",.8).toString(),t.lineWidth=1,t.lineJoin=o.selection.shape,t.fillStyle=i.scale("a",.4).toString();var s=Math.min(g.first.x,g.second.x)+.5,r=Math.min(g.first.y,g.second.y)+.5,c=Math.abs(g.second.x-g.first.x)-1,l=Math.abs(g.second.y-g.first.y)-1;t.fillRect(s,r,c,l),t.strokeRect(s,r,c,l),t.restore()}}),a.hooks.shutdown.push(function(e,t){t.unbind("mousemove",n),t.unbind("mousedown",o),m&&x(document).unbind("mouseup",m)})}x.plot.plugins.push({init:e,options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);