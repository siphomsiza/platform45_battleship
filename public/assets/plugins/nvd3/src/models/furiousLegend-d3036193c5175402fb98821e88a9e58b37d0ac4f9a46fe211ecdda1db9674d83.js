nv.models.furiousLegend=function(){"use strict";function e(t){function D(t,e){return"furious"!=K?"#000":G?t.disengaged?E(t,e):"#fff":G?void 0:t.disabled?E(t,e):"#fff"}function L(t,e){return G&&"furious"==K?t.disengaged?"#fff":E(t,e):t.disabled?"#fff":E(t,e)}return t.each(function(t){var e=M-C.left-C.right,n=d3.select(this);nv.utils.initSVG(n);var r=n.selectAll("g.nv-legend").data([t]),i=(r.enter().append("g").attr("class","nvd3 nv-legend").append("g"),r.select("g"));r.attr("transform","translate("+C.left+","+C.top+")");var s,a=i.selectAll(".nv-series").data(function(t){return"furious"!=K?t:t.filter(function(t){return!!G||!t.disengaged})}),o=a.enter().append("g").attr("class","nv-series");if("classic"==K)o.append("circle").style("stroke-width",2).attr("class","nv-legend-symbol").attr("r",5),s=a.select("circle");else if("furious"==K){o.append("rect").style("stroke-width",2).attr("class","nv-legend-symbol").attr("rx",3).attr("ry",3),s=a.select("rect"),o.append("g").attr("class","nv-check-box").property("innerHTML",'<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr("transform","translate(-10,-8)scale(0.5)"),a.select(".nv-check-box").each(function(t,e){d3.select(this).selectAll("path").attr("stroke",D(t,e))})}o.append("text").attr("text-anchor","start").attr("class","nv-legend-text").attr("dy",".32em").attr("dx","8");var u,d=a.select("text.nv-legend-text");switch(a.on("mouseover",function(t,e){H.legendMouseover(t,e)}).on("mouseout",function(t,e){H.legendMouseout(t,e)}).on("click",function(t,e){H.legendClick(t,e);var n=a.data();if(B){if("classic"==K)F?(n.forEach(function(t){t.disabled=!0}),t.disabled=!1):(t.disabled=!t.disabled,n.every(function(t){return t.disabled})&&n.forEach(function(t){t.disabled=!1}));else if("furious"==K)if(G)t.disengaged=!t.disengaged,t.userDisabled=t.userDisabled==undefined?!!t.disabled:t.userDisabled,t.disabled=t.disengaged||t.userDisabled;else if(!G){t.disabled=!t.disabled,t.userDisabled=t.disabled,n.filter(function(t){return!t.disengaged}).every(function(t){return t.userDisabled})&&n.forEach(function(t){t.disabled=t.userDisabled=!1})}H.stateChange({disabled:n.map(function(t){return!!t.disabled}),disengaged:n.map(function(t){return!!t.disengaged})})}}).on("dblclick",function(t,e){if(("furious"!=K||!G)&&(H.legendDblclick(t,e),B)){var n=a.data();n.forEach(function(t){t.disabled=!0,"furious"==K&&(t.userDisabled=t.disabled)}),t.disabled=!1,"furious"==K&&(t.userDisabled=t.disabled),H.stateChange({disabled:n.map(function(t){return!!t.disabled})})}}),a.classed("nv-disabled",function(t){return t.userDisabled}),a.exit().remove(),d.attr("fill",D).text(A),K){case"furious":u=23;break;case"classic":u=20}if(O){var l=[];a.each(function(t){var e,n;if(A(t).length>T){var r=A(t).substring(0,T);e=d3.select(this).select("text").text(r+"..."),d3.select(this).append("svg:title").text(A(t))}else e=d3.select(this).select("text");try{if((n=e.node().getComputedTextLength())<=0)throw Error()}catch(i){n=nv.utils.calcApproxTextWidth(e)}l.push(n+S)});for(var c=0,f=0,g=[];f<e&&c<l.length;)g[c]=l[c],f+=l[c++];for(0===c&&(c=1);e<f&&1<c;){g=[],c--;for(var h=0;h<l.length;h++)l[h]>(g[h%c]||0)&&(g[h%c]=l[h]);f=g.reduce(function(t,e){return t+e})}for(var b=[],p=0,v=0;p<c;p++)b[p]=v,v+=g[p];a.attr("transform",function(t,e){return"translate("+b[e%c]+","+(5+Math.floor(e/c)*u)+")"}),j?i.attr("transform","translate("+(M-C.right-f)+","+C.top+")"):i.attr("transform","translate(0,"+C.top+")"),w=C.top+C.bottom+Math.ceil(l.length/c)*u}else{var m,x=5,k=5,y=0;a.attr("transform",function(){var t=d3.select(this).select("text").node().getComputedTextLength()+S;return m=k,M<C.left+C.right+m+t&&(k=m=5,x+=u),y<(k+=t)&&(y=k),"translate("+m+","+x+")"}),i.attr("transform","translate("+(M-C.right-y)+","+C.top+")"),w=C.top+C.bottom+x+15}"furious"==K&&s.attr("width",function(t,e){return d[0][e].getComputedTextLength()+27}).attr("height",18).attr("y",-9).attr("x",-15),s.style("fill",L).style("stroke",function(t,e){return t.color||E(t,e)})}),e}var C={top:5,right:0,bottom:5,left:0},M=400,w=20,A=function(t){return t.key},E=nv.utils.getColor(),T=20,O=!0,S=28,j=!0,B=!0,F=!1,G=!1,H=d3.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout","stateChange"),K="classic";return e.dispatch=H,e.options=nv.utils.optionsFunc.bind(e),e._options=Object.create({},{width:{get:function(){return M},set:function(t){M=t}},height:{get:function(){return w},set:function(t){w=t}},key:{get:function(){return A},set:function(t){A=t}},align:{get:function(){return O},set:function(t){O=t}},rightAlign:{get:function(){return j},set:function(t){j=t}},maxKeyLength:{get:function(){return T},set:function(t){T=t}},padding:{get:function(){return S},set:function(t){S=t}},updateState:{get:function(){return B},set:function(t){B=t}},radioButtonMode:{get:function(){return F},set:function(t){F=t}},expanded:{get:function(){return G},set:function(t){G=t}},vers:{get:function(){return K},set:function(t){K=t}},margin:{get:function(){return C},set:function(t){C.top=t.top!==undefined?t.top:C.top,C.right=t.right!==undefined?t.right:C.right,C.bottom=t.bottom!==undefined?t.bottom:C.bottom,C.left=t.left!==undefined?t.left:C.left}},color:{get:function(){return E},set:function(t){E=nv.utils.getColor(t)}}}),nv.utils.initOptions(e),e};