nv.models.pie=function(){"use strict";function e(t){return Z.reset(),t.each(function(t){function e(t,e){t.endAngle=isNaN(t.endAngle)?0:t.endAngle,t.startAngle=isNaN(t.startAngle)?0:t.startAngle,j||(t.innerRadius=0);var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return X[e](n(t))}}var n=L-O.left-O.right,r=w-O.top-O.bottom,i=Math.min(n,r)/2,u=[],a=[];if(F=d3.select(this),0===Q.length)for(var o=i-i/5,s=K*i,l=0;l<t[0].length;l++)u.push(o),a.push(s);else u=Q.map(function(t){return(t.outer-t.outer/5)*i}),a=Q.map(function(t){return(t.inner-t.inner/5)*i}),K=d3.min(Q.map(function(t){return t.inner-t.inner/5}));nv.utils.initSVG(F);var c=F.selectAll(".nv-wrap.nv-pie").data(t),d=c.enter().append("g").attr("class","nvd3 nv-wrap nv-pie nv-chart-"+P).append("g"),f=c.select("g"),g=d.append("g").attr("class","nv-pie");d.append("g").attr("class","nv-pieLabels"),c.attr("transform","translate("+O.left+","+O.top+")"),f.select(".nv-pie").attr("transform","translate("+n/2+","+r/2+")"),f.select(".nv-pieLabels").attr("transform","translate("+n/2+","+r/2+")"),F.on("click",function(t,e){U.chartClick({data:t,index:e,pos:d3.event,id:P})}),X=[],Y=[];for(l=0;l<t[0].length;l++){var p=d3.svg.arc().outerRadius(u[l]),v=d3.svg.arc().outerRadius(u[l]+5);!1!==W&&(p.startAngle(W),v.startAngle(W)),!1!==B&&(p.endAngle(B),v.endAngle(B)),j&&(p.innerRadius(a[l]),v.innerRadius(a[l])),p.cornerRadius&&J&&(p.cornerRadius(J),v.cornerRadius(J)),X.push(p),Y.push(v)}var h=d3.layout.pie().sort(null).value(function(t){return t.disabled?0:I(t)});h.padAngle&&q&&h.padAngle(q),j&&z&&(g.append("text").attr("class","nv-pie-title"),c.select(".nv-pie-title").style("text-anchor","middle").text(function(){return z}).style("font-size",Math.min(n,r)*K*2/(z.length+2)+"px").attr("dy","0.35em").attr("transform",function(){return"translate(0, "+H+")"}));var m=c.select(".nv-pie").selectAll(".nv-slice").data(h),b=c.select(".nv-pieLabels").selectAll(".nv-label").data(h);m.exit().remove(),b.exit().remove();var A=m.enter().append("g");A.attr("class","nv-slice"),A.on("mouseover",function(t,e){d3.select(this).classed("hover",!0),G&&d3.select(this).select("path").transition().duration(70).attr("d",Y[e]),U.elementMouseover({data:t.data,index:e,color:d3.select(this).style("fill")})}),A.on("mouseout",function(t,e){d3.select(this).classed("hover",!1),G&&d3.select(this).select("path").transition().duration(50).attr("d",X[e]),U.elementMouseout({data:t.data,index:e})}),A.on("mousemove",function(t,e){U.elementMousemove({data:t.data,index:e})}),A.on("click",function(t,e){var n=this;U.elementClick({data:t.data,index:e,color:d3.select(this).style("fill"),event:d3.event,element:n})}),A.on("dblclick",function(t,e){U.elementDblClick({data:t.data,index:e,color:d3.select(this).style("fill")})}),m.attr("fill",function(t,e){return N(t.data,e)}),m.attr("stroke",function(t,e){return N(t.data,e)});A.append("path").each(function(t){this._current=t});if(m.select("path").transition().attr("d",function(t,e){return X[e](t)}).attrTween("d",e),_){var y=[];for(l=0;l<t[0].length;l++)y.push(X[l]),D?j&&(y[l]=d3.svg.arc().outerRadius(X[l].outerRadius()),!1!==W&&y[l].startAngle(W),!1!==B&&y[l].endAngle(B)):j||y[l].innerRadius(0);b.enter().append("g").classed("nv-label",!0).each(function(t){var e=d3.select(this);e.attr("transform",function(t,e){if(V){t.outerRadius=u[e]+10,t.innerRadius=u[e]+15;var n=(t.startAngle+t.endAngle)/2*(180/Math.PI);return(t.startAngle+t.endAngle)/2<Math.PI?n-=90:n+=90,"translate("+y[e].centroid(t)+") rotate("+n+")"}return t.outerRadius=i+10,t.innerRadius=i+15,"translate("+y[e].centroid(t)+")"}),e.append("rect").style("stroke","#fff").style("fill","#fff").attr("rx",3).attr("ry",3),e.append("text").style("text-anchor",V?(t.startAngle+t.endAngle)/2<Math.PI?"start":"end":"middle").style("fill","#000")});var R={},x=14,M=140,k=function(t){return Math.floor(t[0]/M)*M+","+Math.floor(t[1]/x)*x};b.watchTransition(Z,"pie labels").attr("transform",function(t,e){if(V){t.outerRadius=u[e]+10,t.innerRadius=u[e]+15;var n=(t.startAngle+t.endAngle)/2*(180/Math.PI);return(t.startAngle+t.endAngle)/2<Math.PI?n-=90:n+=90,"translate("+y[e].centroid(t)+") rotate("+n+")"}t.outerRadius=i+10,t.innerRadius=i+15;var r=y[e].centroid(t);if(t.value){var a=k(r);R[a]&&(r[1]-=x),R[k(r)]=!0}return"translate("+r+")"}),b.select(".nv-label text").style("text-anchor",function(t){return V?(t.startAngle+t.endAngle)/2<Math.PI?"start":"end":"middle"}).text(function(t,e){var n=(t.endAngle-t.startAngle)/(2*Math.PI),r="";if(!t.value||n<S)return"";if("function"==typeof E)r=E(t,e,{key:C(t.data),value:I(t.data),percent:T(n)});else switch(E){case"key":r=C(t.data);break;case"value":r=T(I(t.data));break;case"percent":r=d3.format("%")(n)}return r})}}),Z.renderEnd("pie immediate"),e}var O={top:0,right:0,bottom:0,left:0},L=500,w=500,C=function(t){return t.x},I=function(t){return t.y},P=Math.floor(1e4*Math.random()),F=null,N=nv.utils.defaultColor(),T=d3.format(",.2f"),_=!0,D=!1,E="key",S=.02,j=!1,z=!1,G=!0,H=0,V=!1,W=!1,q=!1,B=!1,J=0,K=.5,Q=[],U=d3.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove","renderEnd"),X=[],Y=[],Z=nv.utils.renderWatch(U);return e.dispatch=U,e.options=nv.utils.optionsFunc.bind(e),e._options=Object.create({},{arcsRadius:{get:function(){return Q},set:function(t){Q=t}},width:{get:function(){return L},set:function(t){L=t}},height:{get:function(){return w},set:function(t){w=t}},showLabels:{get:function(){return _},set:function(t){_=t}},title:{get:function(){return z},set:function(t){z=t}},titleOffset:{get:function(){return H},set:function(t){H=t}},labelThreshold:{get:function(){return S},set:function(t){S=t}},valueFormat:{get:function(){return T},set:function(t){T=t}},x:{get:function(){return C},set:function(t){C=t}},id:{get:function(){return P},set:function(t){P=t}},endAngle:{get:function(){return B},set:function(t){B=t}},startAngle:{get:function(){return W},set:function(t){W=t}},padAngle:{get:function(){return q},set:function(t){q=t}},cornerRadius:{get:function(){return J},set:function(t){J=t}},donutRatio:{get:function(){return K},set:function(t){K=t}},labelsOutside:{get:function(){return D},set:function(t){D=t}},labelSunbeamLayout:{get:function(){return V},set:function(t){V=t}},donut:{get:function(){return j},set:function(t){j=t}},growOnHover:{get:function(){return G},set:function(t){G=t}},pieLabelsOutside:{get:function(){return D},set:function(t){D=t,nv.deprecated("pieLabelsOutside","use labelsOutside instead")}},donutLabelsOutside:{get:function(){return D},set:function(t){D=t,nv.deprecated("donutLabelsOutside","use labelsOutside instead")}},labelFormat:{get:function(){return T},set:function(t){T=t,nv.deprecated("labelFormat","use valueFormat instead")}},margin:{get:function(){return O},set:function(t){O.top="undefined"!=typeof t.top?t.top:O.top,O.right="undefined"!=typeof t.right?t.right:O.right,O.bottom="undefined"!=typeof t.bottom?t.bottom:O.bottom,O.left="undefined"!=typeof t.left?t.left:O.left}},y:{get:function(){return I},set:function(t){I=d3.functor(t)}},color:{get:function(){return N},set:function(t){N=nv.utils.getColor(t)}},labelType:{get:function(){return E},set:function(t){E=t||"key"}}}),nv.utils.initOptions(e),e};