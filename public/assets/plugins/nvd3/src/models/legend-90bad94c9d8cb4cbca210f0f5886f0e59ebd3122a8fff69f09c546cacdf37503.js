nv.models.legend=function(){"use strict";function t(v){function p(t,e){return"furious"!=h?"#000":f?t.disengaged?"#000":"#fff":f?void 0:(t.color||(t.color=s(t,e)),t.disabled?t.color:"#fff")}function b(t,e){return f&&"furious"==h&&t.disengaged?"#eee":t.color||s(t,e)}function m(t){return f&&"furious"==h?1:t.disabled?0:1}return v.each(function(t){var s=n-e.left-e.right,v=d3.select(this);nv.utils.initSVG(v);var x=v.selectAll("g.nv-legend").data([t]),y=x.enter().append("g").attr("class","nvd3 nv-legend").append("g"),k=x.select("g");x.attr("transform","translate("+e.left+","+e.top+")");var D,L,C=k.selectAll(".nv-series").data(function(t){return"furious"!=h?t:t.filter(function(t){return f?!0:!t.disengaged})}),M=C.enter().append("g").attr("class","nv-series");switch(h){case"furious":L=23;break;case"classic":L=20}if("classic"==h)M.append("circle").style("stroke-width",2).attr("class","nv-legend-symbol").attr("r",5),D=C.select("circle");else if("furious"==h){M.append("rect").style("stroke-width",2).attr("class","nv-legend-symbol").attr("rx",3).attr("ry",3),D=C.select(".nv-legend-symbol"),M.append("g").attr("class","nv-check-box").property("innerHTML",'<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr("transform","translate(-10,-8)scale(0.5)");var w=C.select(".nv-check-box");w.each(function(t,e){d3.select(this).selectAll("path").attr("stroke",p(t,e))})}M.append("text").attr("text-anchor","start").attr("class","nv-legend-text").attr("dy",".32em").attr("dx","8");var A=C.select("text.nv-legend-text");C.on("mouseover",function(t,e){g.legendMouseover(t,e)}).on("mouseout",function(t,e){g.legendMouseout(t,e)}).on("click",function(t,e){g.legendClick(t,e);var n=C.data();if(c){if("classic"==h)u?(n.forEach(function(t){t.disabled=!0}),t.disabled=!1):(t.disabled=!t.disabled,n.every(function(t){return t.disabled})&&n.forEach(function(t){t.disabled=!1}));else if("furious"==h)if(f)t.disengaged=!t.disengaged,t.userDisabled=void 0==t.userDisabled?!!t.disabled:t.userDisabled,t.disabled=t.disengaged||t.userDisabled;else if(!f){t.disabled=!t.disabled,t.userDisabled=t.disabled;var r=n.filter(function(t){return!t.disengaged});r.every(function(t){return t.userDisabled})&&n.forEach(function(t){t.disabled=t.userDisabled=!1})}g.stateChange({disabled:n.map(function(t){return!!t.disabled}),disengaged:n.map(function(t){return!!t.disengaged})})}}).on("dblclick",function(t,e){if(("furious"!=h||!f)&&(g.legendDblclick(t,e),c)){var n=C.data();n.forEach(function(t){t.disabled=!0,"furious"==h&&(t.userDisabled=t.disabled)}),t.disabled=!1,"furious"==h&&(t.userDisabled=t.disabled),g.stateChange({disabled:n.map(function(t){return!!t.disabled})})}}),C.classed("nv-disabled",function(t){return t.userDisabled}),C.exit().remove(),A.attr("fill",p).text(i);var E=0;if(o){var T=[];C.each(function(t){var e;if(i(t).length>a){var n=i(t).substring(0,a);e=d3.select(this).select("text").text(n+"..."),d3.select(this).append("svg:title").text(i(t))}else e=d3.select(this).select("text");var r;try{if(r=e.node().getComputedTextLength(),0>=r)throw Error()}catch(s){r=nv.utils.calcApproxTextWidth(e)}T.push(r+l)});var O=0,S=[];for(E=0;s>E&&O<T.length;)S[O]=T[O],E+=T[O++];for(0===O&&(O=1);E>s&&O>1;){S=[],O--;for(var j=0;j<T.length;j++)T[j]>(S[j%O]||0)&&(S[j%O]=T[j]);E=S.reduce(function(t,e){return t+e})}for(var B=[],F=0,G=0;O>F;F++)B[F]=G,G+=S[F];C.attr("transform",function(t,e){return"translate("+B[e%O]+","+(5+Math.floor(e/O)*L)+")"}),d?k.attr("transform","translate("+(n-e.right-E)+","+e.top+")"):k.attr("transform","translate(0,"+e.top+")"),r=e.top+e.bottom+Math.ceil(T.length/O)*L}else{var H,K=5,V=5,W=0;C.attr("transform",function(){var t=d3.select(this).select("text").node().getComputedTextLength()+l;return H=V,n<e.left+e.right+H+t&&(V=H=5,K+=L),V+=t,V>W&&(W=V),H+W>E&&(E=H+W),"translate("+H+","+K+")"}),k.attr("transform","translate("+(n-e.right-W)+","+e.top+")"),r=e.top+e.bottom+K+15}if("furious"==h){D.attr("width",function(t,e){return A[0][e].getComputedTextLength()+27}).attr("height",18).attr("y",-9).attr("x",-15),y.insert("rect",":first-child").attr("class","nv-legend-bg").attr("fill","#eee").attr("opacity",0);var Z=k.select(".nv-legend-bg");Z.transition().duration(300).attr("x",-L).attr("width",E+L-12).attr("height",r+10).attr("y",-e.top-10).attr("opacity",f?1:0)}D.style("fill",b).style("fill-opacity",m).style("stroke",b)}),t}var e={top:5,right:0,bottom:5,left:0},n=400,r=20,i=function(t){return t.key},s=nv.utils.getColor(),a=20,o=!0,l=32,d=!0,c=!0,u=!1,f=!1,g=d3.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout","stateChange"),h="classic";return t.dispatch=g,t.options=nv.utils.optionsFunc.bind(t),t._options=Object.create({},{width:{get:function(){return n},set:function(t){n=t}},height:{get:function(){return r},set:function(t){r=t}},key:{get:function(){return i},set:function(t){i=t}},align:{get:function(){return o},set:function(t){o=t}},maxKeyLength:{get:function(){return a},set:function(t){a=t}},rightAlign:{get:function(){return d},set:function(t){d=t}},padding:{get:function(){return l},set:function(t){l=t}},updateState:{get:function(){return c},set:function(t){c=t}},radioButtonMode:{get:function(){return u},set:function(t){u=t}},expanded:{get:function(){return f},set:function(t){f=t}},vers:{get:function(){return h},set:function(t){h=t}},margin:{get:function(){return e},set:function(t){e.top=void 0!==t.top?t.top:e.top,e.right=void 0!==t.right?t.right:e.right,e.bottom=void 0!==t.bottom?t.bottom:e.bottom,e.left=void 0!==t.left?t.left:e.left}},color:{get:function(){return s},set:function(t){s=nv.utils.getColor(t)}}}),nv.utils.initOptions(t),t};