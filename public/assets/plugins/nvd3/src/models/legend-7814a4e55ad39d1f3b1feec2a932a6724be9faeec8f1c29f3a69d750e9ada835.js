nv.models.legend=function(){"use strict";function e(t){function L(t,e){return"furious"!=V?"#000":H?t.disengaged?"#000":"#fff":H?void 0:(t.color||(t.color=n(t,e)),t.disabled?t.color:"#fff")}function C(t,e){return H&&"furious"==V&&t.disengaged?"#eee":t.color||n(t,e)}function M(t){return H&&"furious"==V?1:t.disabled?0:1}return t.each(function(t){var e=A-w.left-w.right,n=d3.select(this);nv.utils.initSVG(n);var r=n.selectAll("g.nv-legend").data([t]),i=r.enter().append("g").attr("class","nvd3 nv-legend").append("g"),s=r.select("g");r.attr("transform","translate("+w.left+","+w.top+")");var a,o,l=s.selectAll(".nv-series").data(function(t){return"furious"!=V?t:t.filter(function(t){return!!H||!t.disengaged})}),d=l.enter().append("g").attr("class","nv-series");switch(V){case"furious":o=23;break;case"classic":o=20}if("classic"==V)d.append("circle").style("stroke-width",2).attr("class","nv-legend-symbol").attr("r",5),a=l.select("circle");else if("furious"==V){d.append("rect").style("stroke-width",2).attr("class","nv-legend-symbol").attr("rx",3).attr("ry",3),a=l.select(".nv-legend-symbol"),d.append("g").attr("class","nv-check-box").property("innerHTML",'<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr("transform","translate(-10,-8)scale(0.5)"),l.select(".nv-check-box").each(function(t,e){d3.select(this).selectAll("path").attr("stroke",L(t,e))})}d.append("text").attr("text-anchor","start").attr("class","nv-legend-text").attr("dy",".32em").attr("dx","8");var u=l.select("text.nv-legend-text");l.on("mouseover",function(t,e){K.legendMouseover(t,e)}).on("mouseout",function(t,e){K.legendMouseout(t,e)}).on("click",function(t,e){K.legendClick(t,e);var n=l.data();if(F){if("classic"==V)G?(n.forEach(function(t){t.disabled=!0}),t.disabled=!1):(t.disabled=!t.disabled,n.every(function(t){return t.disabled})&&n.forEach(function(t){t.disabled=!1}));else if("furious"==V)if(H)t.disengaged=!t.disengaged,t.userDisabled=t.userDisabled==undefined?!!t.disabled:t.userDisabled,t.disabled=t.disengaged||t.userDisabled;else if(!H){t.disabled=!t.disabled,t.userDisabled=t.disabled,n.filter(function(t){return!t.disengaged}).every(function(t){return t.userDisabled})&&n.forEach(function(t){t.disabled=t.userDisabled=!1})}K.stateChange({disabled:n.map(function(t){return!!t.disabled}),disengaged:n.map(function(t){return!!t.disengaged})})}}).on("dblclick",function(t,e){if(("furious"!=V||!H)&&(K.legendDblclick(t,e),F)){var n=l.data();n.forEach(function(t){t.disabled=!0,"furious"==V&&(t.userDisabled=t.disabled)}),t.disabled=!1,"furious"==V&&(t.userDisabled=t.disabled),K.stateChange({disabled:n.map(function(t){return!!t.disabled})})}}),l.classed("nv-disabled",function(t){return t.userDisabled}),l.exit().remove(),u.attr("fill",L).text(T);var c=0;if(S){var f=[];l.each(function(t){var e,n;if(T(t).length>O){var r=T(t).substring(0,O);e=d3.select(this).select("text").text(r+"..."),d3.select(this).append("svg:title").text(T(t))}else e=d3.select(this).select("text");try{if((n=e.node().getComputedTextLength())<=0)throw Error()}catch(i){n=nv.utils.calcApproxTextWidth(e)}f.push(n+j)});var g=0,h=[];for(c=0;c<e&&g<f.length;)h[g]=f[g],c+=f[g++];for(0===g&&(g=1);e<c&&1<g;){h=[],g--;for(var p=0;p<f.length;p++)f[p]>(h[p%g]||0)&&(h[p%g]=f[p]);c=h.reduce(function(t,e){return t+e})}for(var b=[],v=0,m=0;v<g;v++)b[v]=m,m+=h[v];l.attr("transform",function(t,e){return"translate("+b[e%g]+","+(5+Math.floor(e/g)*o)+")"}),B?s.attr("transform","translate("+(A-w.right-c)+","+w.top+")"):s.attr("transform","translate(0,"+w.top+")"),E=w.top+w.bottom+Math.ceil(f.length/g)*o}else{var x,y=5,k=5,D=0;l.attr("transform",function(){var t=d3.select(this).select("text").node().getComputedTextLength()+j;return x=k,A<w.left+w.right+x+t&&(k=x=5,y+=o),D<(k+=t)&&(D=k),c<x+D&&(c=x+D),"translate("+x+","+y+")"}),s.attr("transform","translate("+(A-w.right-D)+","+w.top+")"),E=w.top+w.bottom+y+15}"furious"==V&&(a.attr("width",function(t,e){return u[0][e].getComputedTextLength()+27}).attr("height",18).attr("y",-9).attr("x",-15),i.insert("rect",":first-child").attr("class","nv-legend-bg").attr("fill","#eee").attr("opacity",0),s.select(".nv-legend-bg").transition().duration(300).attr("x",-o).attr("width",c+o-12).attr("height",E+10).attr("y",-w.top-10).attr("opacity",H?1:0));a.style("fill",C).style("fill-opacity",M).style("stroke",C)}),e}var w={top:5,right:0,bottom:5,left:0},A=400,E=20,T=function(t){return t.key},n=nv.utils.getColor(),O=20,S=!0,j=32,B=!0,F=!0,G=!1,H=!1,K=d3.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout","stateChange"),V="classic";return e.dispatch=K,e.options=nv.utils.optionsFunc.bind(e),e._options=Object.create({},{width:{get:function(){return A},set:function(t){A=t}},height:{get:function(){return E},set:function(t){E=t}},key:{get:function(){return T},set:function(t){T=t}},align:{get:function(){return S},set:function(t){S=t}},maxKeyLength:{get:function(){return O},set:function(t){O=t}},rightAlign:{get:function(){return B},set:function(t){B=t}},padding:{get:function(){return j},set:function(t){j=t}},updateState:{get:function(){return F},set:function(t){F=t}},radioButtonMode:{get:function(){return G},set:function(t){G=t}},expanded:{get:function(){return H},set:function(t){H=t}},vers:{get:function(){return V},set:function(t){V=t}},margin:{get:function(){return w},set:function(t){w.top=t.top!==undefined?t.top:w.top,w.right=t.right!==undefined?t.right:w.right,w.bottom=t.bottom!==undefined?t.bottom:w.bottom,w.left=t.left!==undefined?t.left:w.left}},color:{get:function(){return n},set:function(t){n=nv.utils.getColor(t)}}}),nv.utils.initOptions(e),e};