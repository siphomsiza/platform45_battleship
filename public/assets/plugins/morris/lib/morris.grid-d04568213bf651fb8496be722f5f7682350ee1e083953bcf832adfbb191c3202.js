(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}},i=function(t,i){function s(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t},e={}.hasOwnProperty;Morris.Grid=function(e){function s(i){if(this.resizeHandler=t(this.resizeHandler,this),"string"==typeof i.element?this.el=$(document.getElementById(i.element)):this.el=$(i.element),null==this.el||0===this.el.length)throw new Error("Graph container element not found");"static"===this.el.css("position")&&this.el.css("position","relative"),this.options=$.extend({},this.gridDefaults,this.defaults||{},i),"string"==typeof this.options.units&&(this.options.postUnits=i.units),this.raphael=new Raphael(this.el[0]),this.elementWidth=null,this.elementHeight=null,this.dirty=!1,this.selectFrom=null,this.init&&this.init(),this.setData(this.options.data),this.el.bind("mousemove",function(t){return function(i){var e,s,n,o,r;return s=t.el.offset(),r=i.pageX-s.left,t.selectFrom?(e=t.data[t.hitTest(Math.min(r,t.selectFrom))]._x,n=t.data[t.hitTest(Math.max(r,t.selectFrom))]._x,o=n-e,t.selectionRect.attr({x:e,width:o})):t.fire("hovermove",r,i.pageY-s.top)}}(this)),this.el.bind("mouseleave",function(t){return function(){return t.selectFrom&&(t.selectionRect.hide(),t.selectFrom=null),t.fire("hoverout")}}(this)),this.el.bind("touchstart touchmove touchend",function(t){return function(i){var e,s;return s=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0],e=t.el.offset(),t.fire("hovermove",s.pageX-e.left,s.pageY-e.top)}}(this)),this.el.bind("click",function(t){return function(i){var e;return e=t.el.offset(),t.fire("gridclick",i.pageX-e.left,i.pageY-e.top)}}(this)),this.options.rangeSelect&&(this.selectionRect=this.raphael.rect(0,0,0,this.el.innerHeight()).attr({fill:this.options.rangeSelectColor,stroke:!1}).toBack().hide(),this.el.bind("mousedown",function(t){return function(i){var e;return e=t.el.offset(),t.startRange(i.pageX-e.left)}}(this)),this.el.bind("mouseup",function(t){return function(i){var e;return e=t.el.offset(),t.endRange(i.pageX-e.left),t.fire("hovermove",i.pageX-e.left,i.pageY-e.top)}}(this))),this.options.resize&&$(window).bind("resize",function(t){return function(){return null!=t.timeoutId&&window.clearTimeout(t.timeoutId),t.timeoutId=window.setTimeout(t.resizeHandler,100)}}(this)),this.el.css("-webkit-tap-highlight-color","rgba(0,0,0,0)"),this.postInit&&this.postInit()}return i(s,e),s.prototype.gridDefaults={dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,gridTextFamily:"sans-serif",gridTextWeight:"normal",hideHover:!1,yLabelFormat:null,xLabelAngle:0,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"],rangeSelect:null,rangeSelectColor:"#eef",resize:!1},s.prototype.setData=function(t,i){var e,s,n,o,r,h,a,l,p,d,u,m,c,g,f;return null==i&&(i=!0),this.options.data=t,null==t||0===t.length?(this.data=[],this.raphael.clear(),void(null!=this.hover&&this.hover.hide())):(c=this.cumulative?0:null,g=this.cumulative?0:null,this.options.goals.length>0&&(r=Math.min.apply(Math,this.options.goals),o=Math.max.apply(Math,this.options.goals),g=null!=g?Math.min(g,r):r,c=null!=c?Math.max(c,o):o),this.data=function(){var i,e,o;for(o=[],n=i=0,e=t.length;e>i;n=++i)l=t[n],a={src:l},a.label=l[this.options.xkey],this.options.parseTime?(a.x=Morris.parseDate(a.label),this.options.dateFormat?a.label=this.options.dateFormat(a.x):"number"==typeof a.label&&(a.label=new Date(a.label).toString())):(a.x=n,this.options.xLabelFormat&&(a.label=this.options.xLabelFormat(a))),d=0,a.y=function(){var t,i,e,n;for(e=this.options.ykeys,n=[],s=t=0,i=e.length;i>t;s=++t)m=e[s],f=l[m],"string"==typeof f&&(f=parseFloat(f)),null!=f&&"number"!=typeof f&&(f=null),null!=f&&(this.cumulative?d+=f:null!=c?(c=Math.max(f,c),g=Math.min(f,g)):c=g=f),this.cumulative&&null!=d&&(c=Math.max(d,c),g=Math.min(d,g)),n.push(f);return n}.call(this),o.push(a);return o}.call(this),this.options.parseTime&&(this.data=this.data.sort(function(t,i){return(t.x>i.x)-(i.x>t.x)})),this.xmin=this.data[0].x,this.xmax=this.data[this.data.length-1].x,this.events=[],this.options.events.length>0&&(this.options.parseTime?this.events=function(){var t,i,s,n;for(s=this.options.events,n=[],t=0,i=s.length;i>t;t++)e=s[t],n.push(Morris.parseDate(e));return n}.call(this):this.events=this.options.events,this.xmax=Math.max(this.xmax,Math.max.apply(Math,this.events)),this.xmin=Math.min(this.xmin,Math.min.apply(Math,this.events))),this.xmin===this.xmax&&(this.xmin-=1,this.xmax+=1),this.ymin=this.yboundary("min",g),this.ymax=this.yboundary("max",c),this.ymin===this.ymax&&(g&&(this.ymin-=1),this.ymax+=1),(h=this.options.axes)!==!0&&"both"!==h&&"y"!==h&&this.options.grid!==!0||(this.options.ymax===this.gridDefaults.ymax&&this.options.ymin===this.gridDefaults.ymin?(this.grid=this.autoGridLines(this.ymin,this.ymax,this.options.numLines),this.ymin=Math.min(this.ymin,this.grid[0]),this.ymax=Math.max(this.ymax,this.grid[this.grid.length-1])):(p=(this.ymax-this.ymin)/(this.options.numLines-1),this.grid=function(){var t,i,e,s,n;for(n=[],u=t=i=this.ymin,e=this.ymax,s=p;s>0?e>=t:t>=e;u=t+=s)n.push(u);return n}.call(this))),this.dirty=!0,i?this.redraw():void 0)},s.prototype.yboundary=function(t,i){var e,s;return e=this.options["y"+t],"string"==typeof e?"auto"===e.slice(0,4)?e.length>5?(s=parseInt(e.slice(5),10),null==i?s:Math[t](i,s)):null!=i?i:0:parseInt(e,10):e},s.prototype.autoGridLines=function(t,i,e){var s,n,o,r,h,a,l,p,d;return h=i-t,d=Math.floor(Math.log(h)/Math.log(10)),l=Math.pow(10,d),n=Math.floor(t/l)*l,s=Math.ceil(i/l)*l,a=(s-n)/(e-1),1===l&&a>1&&Math.ceil(a)!==a&&(a=Math.ceil(a),s=n+a*(e-1)),0>n&&s>0&&(n=Math.floor(t/a)*a,s=Math.ceil(i/a)*a),1>a?(r=Math.floor(Math.log(a)/Math.log(10)),o=function(){var t,i,e,o,h;for(h=[],p=t=i=n,e=s,o=a;o>0?e>=t:t>=e;p=t+=o)h.push(parseFloat(p.toFixed(1-r)));return h}()):o=function(){var t,i,e,o,r;for(r=[],p=t=i=n,e=s,o=a;o>0?e>=t:t>=e;p=t+=o)r.push(p);return r}(),o},s.prototype._calc=function(){var t,i,e,s,n,o,r,h;return r=this.el.width(),e=this.el.height(),(this.elementWidth!==r||this.elementHeight!==e||this.dirty)&&(this.elementWidth=r,this.elementHeight=e,this.dirty=!1,this.left=this.options.padding,this.right=this.elementWidth-this.options.padding,this.top=this.options.padding,this.bottom=this.elementHeight-this.options.padding,(n=this.options.axes)!==!0&&"both"!==n&&"y"!==n||(h=function(){var t,e,s,n;for(s=this.grid,n=[],t=0,e=s.length;e>t;t++)i=s[t],n.push(this.measureText(this.yAxisFormat(i)).width);return n}.call(this),this.left+=Math.max.apply(Math,h)),(o=this.options.axes)!==!0&&"both"!==o&&"x"!==o||(t=function(){var t,i,e;for(e=[],s=t=0,i=this.data.length;i>=0?i>t:t>i;s=i>=0?++t:--t)e.push(this.measureText(this.data[s].text,-this.options.xLabelAngle).height);return e}.call(this),this.bottom-=Math.max.apply(Math,t)),this.width=Math.max(1,this.right-this.left),this.height=Math.max(1,this.bottom-this.top),this.dx=this.width/(this.xmax-this.xmin),this.dy=this.height/(this.ymax-this.ymin),this.calc)?this.calc():void 0},s.prototype.transY=function(t){return this.bottom-(t-this.ymin)*this.dy},s.prototype.transX=function(t){return 1===this.data.length?(this.left+this.right)/2:this.left+(t-this.xmin)*this.dx},s.prototype.redraw=function(){return this.raphael.clear(),this._calc(),this.drawGrid(),this.drawGoals(),this.drawEvents(),this.draw?this.draw():void 0},s.prototype.measureText=function(t,i){var e,s;return null==i&&(i=0),s=this.raphael.text(100,100,t).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).rotate(i),e=s.getBBox(),s.remove(),e},s.prototype.yAxisFormat=function(t){return this.yLabelFormat(t)},s.prototype.yLabelFormat=function(t){return"function"==typeof this.options.yLabelFormat?this.options.yLabelFormat(t):""+this.options.preUnits+Morris.commas(t)+this.options.postUnits},s.prototype.drawGrid=function(){var t,i,e,s,n,o,r,h;if(this.options.grid!==!1||(s=this.options.axes)===!0||"both"===s||"y"===s){for(n=this.grid,r=[],t=0,i=n.length;i>t;t++)e=n[t],h=this.transY(e),(o=this.options.axes)!==!0&&"both"!==o&&"y"!==o||this.drawYAxisLabel(this.left-this.options.padding/2,h,this.yAxisFormat(e)),this.options.grid?r.push(this.drawGridLine("M"+this.left+","+h+"H"+(this.left+this.width))):r.push(void 0);return r}},s.prototype.drawGoals=function(){var t,i,e,s,n,o,r;for(o=this.options.goals,r=[],e=s=0,n=o.length;n>s;e=++s)i=o[e],t=this.options.goalLineColors[e%this.options.goalLineColors.length],r.push(this.drawGoal(i,t));return r},s.prototype.drawEvents=function(){var t,i,e,s,n,o,r;for(o=this.events,r=[],e=s=0,n=o.length;n>s;e=++s)i=o[e],t=this.options.eventLineColors[e%this.options.eventLineColors.length],r.push(this.drawEvent(i,t));return r},s.prototype.drawGoal=function(t,i){return this.raphael.path("M"+this.left+","+this.transY(t)+"H"+this.right).attr("stroke",i).attr("stroke-width",this.options.goalStrokeWidth)},s.prototype.drawEvent=function(t,i){return this.raphael.path("M"+this.transX(t)+","+this.bottom+"V"+this.top).attr("stroke",i).attr("stroke-width",this.options.eventStrokeWidth)},s.prototype.drawYAxisLabel=function(t,i,e){return this.raphael.text(t,i,e).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).attr("fill",this.options.gridTextColor).attr("text-anchor","end")},s.prototype.drawGridLine=function(t){return this.raphael.path(t).attr("stroke",this.options.gridLineColor).attr("stroke-width",this.options.gridStrokeWidth)},s.prototype.startRange=function(t){return this.hover.hide(),this.selectFrom=t,this.selectionRect.attr({x:t,width:0}).show()},s.prototype.endRange=function(t){var i,e;return this.selectFrom?(e=Math.min(this.selectFrom,t),i=Math.max(this.selectFrom,t),this.options.rangeSelect.call(this.el,{start:this.data[this.hitTest(e)].x,end:this.data[this.hitTest(i)].x}),this.selectFrom=null):void 0},s.prototype.resizeHandler=function(){return this.timeoutId=null,this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()},s}(Morris.EventEmitter),Morris.parseDate=function(t){var i,e,s,n,o,r,h,a,l,p,d;return"number"==typeof t?t:(e=t.match(/^(\d+) Q(\d)$/),n=t.match(/^(\d+)-(\d+)$/),o=t.match(/^(\d+)-(\d+)-(\d+)$/),h=t.match(/^(\d+) W(\d+)$/),a=t.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+)(Z|([+-])(\d\d):?(\d\d))?$/),l=t.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+):(\d+(\.\d+)?)(Z|([+-])(\d\d):?(\d\d))?$/),e?new Date(parseInt(e[1],10),3*parseInt(e[2],10)-1,1).getTime():n?new Date(parseInt(n[1],10),parseInt(n[2],10)-1,1).getTime():o?new Date(parseInt(o[1],10),parseInt(o[2],10)-1,parseInt(o[3],10)).getTime():h?(p=new Date(parseInt(h[1],10),0,1),4!==p.getDay()&&p.setMonth(0,1+(4-p.getDay()+7)%7),p.getTime()+6048e5*parseInt(h[2],10)):a?a[6]?(r=0,"Z"!==a[6]&&(r=60*parseInt(a[8],10)+parseInt(a[9],10),"+"===a[7]&&(r=0-r)),Date.UTC(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10)+r)):new Date(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10)).getTime():l?(d=parseFloat(l[6]),i=Math.floor(d),s=Math.round(1e3*(d-i)),l[8]?(r=0,"Z"!==l[8]&&(r=60*parseInt(l[10],10)+parseInt(l[11],10),"+"===l[9]&&(r=0-r)),Date.UTC(parseInt(l[1],10),parseInt(l[2],10)-1,parseInt(l[3],10),parseInt(l[4],10),parseInt(l[5],10)+r,i,s)):new Date(parseInt(l[1],10),parseInt(l[2],10)-1,parseInt(l[3],10),parseInt(l[4],10),parseInt(l[5],10),i,s).getTime()):new Date(parseInt(t,10),0,1).getTime())}}).call(this);