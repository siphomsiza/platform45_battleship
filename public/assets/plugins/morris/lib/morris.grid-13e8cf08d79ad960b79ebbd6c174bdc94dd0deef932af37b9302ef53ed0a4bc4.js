(function(){var a=function(t,i){return function(){return t.apply(i,arguments)}},e=function(t,i){function e(){this.constructor=t}for(var s in i)n.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t},n={}.hasOwnProperty;Morris.Grid=function(t){function i(t){if(this.resizeHandler=a(this.resizeHandler,this),"string"==typeof t.element?this.el=$(document.getElementById(t.element)):this.el=$(t.element),null==this.el||0===this.el.length)throw new Error("Graph container element not found");var o,i,s,e,n,h,r;"static"===this.el.css("position")&&this.el.css("position","relative"),this.options=$.extend({},this.gridDefaults,this.defaults||{},t),"string"==typeof this.options.units&&(this.options.postUnits=t.units),this.raphael=new Raphael(this.el[0]),this.elementWidth=null,this.elementHeight=null,this.dirty=!1,this.selectFrom=null,this.init&&this.init(),this.setData(this.options.data),this.el.bind("mousemove",(o=this,function(t){var i,e,s,n;return e=o.el.offset(),n=t.pageX-e.left,o.selectFrom?(i=o.data[o.hitTest(Math.min(n,o.selectFrom))]._x,s=o.data[o.hitTest(Math.max(n,o.selectFrom))]._x-i,o.selectionRect.attr({x:i,width:s})):o.fire("hovermove",n,t.pageY-e.top)})),this.el.bind("mouseleave",(i=this,function(){return i.selectFrom&&(i.selectionRect.hide(),i.selectFrom=null),i.fire("hoverout")})),this.el.bind("touchstart touchmove touchend",(s=this,function(t){var i,e;return e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],i=s.el.offset(),s.fire("hovermove",e.pageX-i.left,e.pageY-i.top)})),this.el.bind("click",(e=this,function(t){var i;return i=e.el.offset(),e.fire("gridclick",t.pageX-i.left,t.pageY-i.top)})),this.options.rangeSelect&&(this.selectionRect=this.raphael.rect(0,0,0,this.el.innerHeight()).attr({fill:this.options.rangeSelectColor,stroke:!1}).toBack().hide(),this.el.bind("mousedown",(h=this,function(t){var i;return i=h.el.offset(),h.startRange(t.pageX-i.left)})),this.el.bind("mouseup",(n=this,function(t){var i;return i=n.el.offset(),n.endRange(t.pageX-i.left),n.fire("hovermove",t.pageX-i.left,t.pageY-i.top)}))),this.options.resize&&$(window).bind("resize",(r=this,function(){return null!=r.timeoutId&&window.clearTimeout(r.timeoutId),r.timeoutId=window.setTimeout(r.resizeHandler,100)})),this.el.css("-webkit-tap-highlight-color","rgba(0,0,0,0)"),this.postInit&&this.postInit()}return e(i,t),i.prototype.gridDefaults={dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,gridTextFamily:"sans-serif",gridTextWeight:"normal",hideHover:!1,yLabelFormat:null,xLabelAngle:0,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"],rangeSelect:null,rangeSelectColor:"#eef",resize:!1},i.prototype.setData=function(s,t){var n,o,h,i,e,r,a,l,p,d,u,m,c,g,f;return null==t&&(t=!0),null==(this.options.data=s)||0===s.length?(this.data=[],this.raphael.clear(),void(null!=this.hover&&this.hover.hide())):(c=this.cumulative?0:null,g=this.cumulative?0:null,0<this.options.goals.length&&(e=Math.min.apply(Math,this.options.goals),i=Math.max.apply(Math,this.options.goals),g=null!=g?Math.min(g,e):e,c=null!=c?Math.max(c,i):i),this.data=function(){var t,i,e;for(e=[],h=t=0,i=s.length;t<i;h=++t)l=s[h],(a={src:l}).label=l[this.options.xkey],this.options.parseTime?(a.x=Morris.parseDate(a.label),this.options.dateFormat?a.label=this.options.dateFormat(a.x):"number"==typeof a.label&&(a.label=new Date(a.label).toString())):(a.x=h,this.options.xLabelFormat&&(a.label=this.options.xLabelFormat(a))),d=0,a.y=function(){var t,i,e,s;for(e=this.options.ykeys,s=[],o=t=0,i=e.length;t<i;o=++t)m=e[o],"string"==typeof(f=l[m])&&(f=parseFloat(f)),null!=f&&"number"!=typeof f&&(f=null),null!=f&&(this.cumulative?d+=f:null!=c?(c=Math.max(f,c),g=Math.min(f,g)):c=g=f),this.cumulative&&null!=d&&(c=Math.max(d,c),g=Math.min(d,g)),s.push(f);return s}.call(this),e.push(a);return e}.call(this),this.options.parseTime&&(this.data=this.data.sort(function(t,i){return(t.x>i.x)-(i.x>t.x)})),this.xmin=this.data[0].x,this.xmax=this.data[this.data.length-1].x,this.events=[],0<this.options.events.length&&(this.options.parseTime?this.events=function(){var t,i,e,s;for(s=[],t=0,i=(e=this.options.events).length;t<i;t++)n=e[t],s.push(Morris.parseDate(n));return s}.call(this):this.events=this.options.events,this.xmax=Math.max(this.xmax,Math.max.apply(Math,this.events)),this.xmin=Math.min(this.xmin,Math.min.apply(Math,this.events))),this.xmin===this.xmax&&(this.xmin-=1,this.xmax+=1),this.ymin=this.yboundary("min",g),this.ymax=this.yboundary("max",c),this.ymin===this.ymax&&(g&&(this.ymin-=1),this.ymax+=1),!0!==(r=this.options.axes)&&"both"!==r&&"y"!==r&&!0!==this.options.grid||(this.options.ymax===this.gridDefaults.ymax&&this.options.ymin===this.gridDefaults.ymin?(this.grid=this.autoGridLines(this.ymin,this.ymax,this.options.numLines),this.ymin=Math.min(this.ymin,this.grid[0]),this.ymax=Math.max(this.ymax,this.grid[this.grid.length-1])):(p=(this.ymax-this.ymin)/(this.options.numLines-1),this.grid=function(){var t,i,e,s;for(s=[],u=t=this.ymin,i=this.ymax,e=p;0<e?t<=i:i<=t;u=t+=e)s.push(u);return s}.call(this))),this.dirty=!0,t?this.redraw():void 0)},i.prototype.yboundary=function(t,i){var e,s;return"string"==typeof(e=this.options["y"+t])?"auto"===e.slice(0,4)?5<e.length?(s=parseInt(e.slice(5),10),null==i?s:Math[t](i,s)):null!=i?i:0:parseInt(e,10):e},i.prototype.autoGridLines=function(t,i,e){var n,o,s,h,r,a,l,p,d;return r=i-t,d=Math.floor(Math.log(r)/Math.log(10)),l=Math.pow(10,d),o=Math.floor(t/l)*l,n=Math.ceil(i/l)*l,a=(n-o)/(e-1),1===l&&1<a&&Math.ceil(a)!==a&&(a=Math.ceil(a),n=o+a*(e-1)),o<0&&0<n&&(o=Math.floor(t/a)*a,n=Math.ceil(i/a)*a),a<1?(h=Math.floor(Math.log(a)/Math.log(10)),s=function(){var t,i,e,s;for(s=[],p=t=o,i=n,e=a;0<e?t<=i:i<=t;p=t+=e)s.push(parseFloat(p.toFixed(1-h)));return s}()):s=function(){var t,i,e,s;for(s=[],p=t=o,i=n,e=a;0<e?t<=i:i<=t;p=t+=e)s.push(p);return s}(),s},i.prototype._calc=function(){var t,n,i,s,e,o,h,r;if(h=this.el.width(),i=this.el.height(),(this.elementWidth!==h||this.elementHeight!==i||this.dirty)&&(this.elementWidth=h,this.elementHeight=i,this.dirty=!1,this.left=this.options.padding,this.right=this.elementWidth-this.options.padding,this.top=this.options.padding,this.bottom=this.elementHeight-this.options.padding,!0!==(e=this.options.axes)&&"both"!==e&&"y"!==e||(r=function(){var t,i,e,s;for(s=[],t=0,i=(e=this.grid).length;t<i;t++)n=e[t],s.push(this.measureText(this.yAxisFormat(n)).width);return s}.call(this),this.left+=Math.max.apply(Math,r)),!0!==(o=this.options.axes)&&"both"!==o&&"x"!==o||(t=function(){var t,i,e;for(e=[],s=t=0,i=this.data.length;0<=i?t<i:i<t;s=0<=i?++t:--t)e.push(this.measureText(this.data[s].text,-this.options.xLabelAngle).height);return e}.call(this),this.bottom-=Math.max.apply(Math,t)),this.width=Math.max(1,this.right-this.left),this.height=Math.max(1,this.bottom-this.top),this.dx=this.width/(this.xmax-this.xmin),this.dy=this.height/(this.ymax-this.ymin),this.calc))return this.calc()},i.prototype.transY=function(t){return this.bottom-(t-this.ymin)*this.dy},i.prototype.transX=function(t){return 1===this.data.length?(this.left+this.right)/2:this.left+(t-this.xmin)*this.dx},i.prototype.redraw=function(){if(this.raphael.clear(),this._calc(),this.drawGrid(),this.drawGoals(),this.drawEvents(),this.draw)return this.draw()},i.prototype.measureText=function(t,i){var e,s;return null==i&&(i=0),e=(s=this.raphael.text(100,100,t).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).rotate(i)).getBBox(),s.remove(),e},i.prototype.yAxisFormat=function(t){return this.yLabelFormat(t)},i.prototype.yLabelFormat=function(t){return"function"==typeof this.options.yLabelFormat?this.options.yLabelFormat(t):""+this.options.preUnits+Morris.commas(t)+this.options.postUnits},i.prototype.drawGrid=function(){var t,i,e,s,n,o,h,r;if(!1!==this.options.grid||!0===(s=this.options.axes)||"both"===s||"y"===s){for(h=[],t=0,i=(n=this.grid).length;t<i;t++)e=n[t],r=this.transY(e),!0!==(o=this.options.axes)&&"both"!==o&&"y"!==o||this.drawYAxisLabel(this.left-this.options.padding/2,r,this.yAxisFormat(e)),this.options.grid?h.push(this.drawGridLine("M"+this.left+","+r+"H"+(this.left+this.width))):h.push(void 0);return h}},i.prototype.drawGoals=function(){var t,i,e,s,n,o,h;for(h=[],e=s=0,n=(o=this.options.goals).length;s<n;e=++s)i=o[e],t=this.options.goalLineColors[e%this.options.goalLineColors.length],h.push(this.drawGoal(i,t));return h},i.prototype.drawEvents=function(){var t,i,e,s,n,o,h;for(h=[],e=s=0,n=(o=this.events).length;s<n;e=++s)i=o[e],t=this.options.eventLineColors[e%this.options.eventLineColors.length],h.push(this.drawEvent(i,t));return h},i.prototype.drawGoal=function(t,i){return this.raphael.path("M"+this.left+","+this.transY(t)+"H"+this.right).attr("stroke",i).attr("stroke-width",this.options.goalStrokeWidth)},i.prototype.drawEvent=function(t,i){return this.raphael.path("M"+this.transX(t)+","+this.bottom+"V"+this.top).attr("stroke",i).attr("stroke-width",this.options.eventStrokeWidth)},i.prototype.drawYAxisLabel=function(t,i,e){return this.raphael.text(t,i,e).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).attr("fill",this.options.gridTextColor).attr("text-anchor","end")},i.prototype.drawGridLine=function(t){return this.raphael.path(t).attr("stroke",this.options.gridLineColor).attr("stroke-width",this.options.gridStrokeWidth)},i.prototype.startRange=function(t){return this.hover.hide(),this.selectFrom=t,this.selectionRect.attr({x:t,width:0}).show()},i.prototype.endRange=function(t){var i,e;if(this.selectFrom)return e=Math.min(this.selectFrom,t),i=Math.max(this.selectFrom,t),this.options.rangeSelect.call(this.el,{start:this.data[this.hitTest(e)].x,end:this.data[this.hitTest(i)].x}),this.selectFrom=null},i.prototype.resizeHandler=function(){return this.timeoutId=null,this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()},i}(Morris.EventEmitter),Morris.parseDate=function(t){var i,e,s,n,o,h,r,a,l,p,d;return"number"==typeof t?t:(e=t.match(/^(\d+) Q(\d)$/),n=t.match(/^(\d+)-(\d+)$/),o=t.match(/^(\d+)-(\d+)-(\d+)$/),r=t.match(/^(\d+) W(\d+)$/),a=t.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+)(Z|([+-])(\d\d):?(\d\d))?$/),l=t.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+):(\d+(\.\d+)?)(Z|([+-])(\d\d):?(\d\d))?$/),e?new Date(parseInt(e[1],10),3*parseInt(e[2],10)-1,1).getTime():n?new Date(parseInt(n[1],10),parseInt(n[2],10)-1,1).getTime():o?new Date(parseInt(o[1],10),parseInt(o[2],10)-1,parseInt(o[3],10)).getTime():r?(4!==(p=new Date(parseInt(r[1],10),0,1)).getDay()&&p.setMonth(0,1+(4-p.getDay()+7)%7),p.getTime()+6048e5*parseInt(r[2],10)):a?a[6]?(h=0,"Z"!==a[6]&&(h=60*parseInt(a[8],10)+parseInt(a[9],10),"+"===a[7]&&(h=0-h)),Date.UTC(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10)+h)):new Date(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10)).getTime():l?(d=parseFloat(l[6]),i=Math.floor(d),s=Math.round(1e3*(d-i)),l[8]?(h=0,"Z"!==l[8]&&(h=60*parseInt(l[10],10)+parseInt(l[11],10),"+"===l[9]&&(h=0-h)),Date.UTC(parseInt(l[1],10),parseInt(l[2],10)-1,parseInt(l[3],10),parseInt(l[4],10),parseInt(l[5],10)+h,i,s)):new Date(parseInt(l[1],10),parseInt(l[2],10)-1,parseInt(l[3],10),parseInt(l[4],10),parseInt(l[5],10),i,s).getTime()):new Date(parseInt(t,10),0,1).getTime())}}).call(this);