(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function s(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},i={}.hasOwnProperty;Morris.Donut=function(i){function s(e){if(this.resizeHandler=t(this.resizeHandler,this),this.select=t(this.select,this),this.click=t(this.click,this),!(this instanceof Morris.Donut))return new Morris.Donut(e);if(this.options=$.extend({},this.defaults,e),"string"==typeof e.element?this.el=$(document.getElementById(e.element)):this.el=$(e.element),null===this.el||0===this.el.length)throw new Error("Graph placeholder not found.");void 0!==e.data&&0!==e.data.length&&(this.raphael=new Raphael(this.el[0]),this.options.resize&&$(window).bind("resize",function(t){return function(){return null!=t.timeoutId&&window.clearTimeout(t.timeoutId),t.timeoutId=window.setTimeout(t.resizeHandler,100)}}(this)),this.setData(e.data))}return e(s,i),s.prototype.defaults={colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:Morris.commas,resize:!1},s.prototype.redraw=function(){var t,e,i,s,r,h,n,o,a,l,c,u,p,d,f,g,m,y,w,v,x,M,k;for(this.raphael.clear(),e=this.el.width()/2,i=this.el.height()/2,k=(Math.min(e,i)-10)/3,x=0,g=this.values,h=0,l=g.length;l>h;h++)M=g[h],x+=M;for(d=5/(2*k),t=1.9999*Math.PI-d*this.data.length,a=0,r=0,this.segments=[],m=this.values,s=n=0,c=m.length;c>n;s=++n)M=m[s],f=a+d+t*(M/x),v=new Morris.DonutSegment(e,i,2*k,k,a,f,this.data[s].color||this.options.colors[r%this.options.colors.length],this.options.backgroundColor,r,this.raphael),v.render(),this.segments.push(v),v.on("hover",this.select),v.on("click",this.click),a=f,r+=1;for(this.text1=this.drawEmptyDonutLabel(e,i-10,this.options.labelColor,15,800),this.text2=this.drawEmptyDonutLabel(e,i+10,this.options.labelColor,14),p=Math.max.apply(Math,this.values),r=0,y=this.values,w=[],o=0,u=y.length;u>o;o++){if(M=y[o],M===p){this.select(r);break}w.push(r+=1)}return w},s.prototype.setData=function(t){var e;return this.data=t,this.values=function(){var t,i,s,r;for(s=this.data,r=[],t=0,i=s.length;i>t;t++)e=s[t],r.push(parseFloat(e.value));return r}.call(this),this.redraw()},s.prototype.click=function(t){return this.fire("click",t,this.data[t])},s.prototype.select=function(t){var e,i,s,r,h,n;for(s=this.segments,e=0,i=s.length;i>e;e++)h=s[e],h.deselect();return n=this.segments[t],n.select(),r=this.data[t],this.setLabels(r.label,this.options.formatter(r.value,r))},s.prototype.setLabels=function(t,e){var i,s,r,h,n,o,a,l;return i=2*(Math.min(this.el.width()/2,this.el.height()/2)-10)/3,h=1.8*i,r=i/2,s=i/3,this.text1.attr({text:t,transform:""}),n=this.text1.getBBox(),o=Math.min(h/n.width,r/n.height),this.text1.attr({transform:"S"+o+","+o+","+(n.x+n.width/2)+","+(n.y+n.height)}),this.text2.attr({text:e,transform:""}),a=this.text2.getBBox(),l=Math.min(h/a.width,s/a.height),this.text2.attr({transform:"S"+l+","+l+","+(a.x+a.width/2)+","+a.y})},s.prototype.drawEmptyDonutLabel=function(t,e,i,s,r){var h;return h=this.raphael.text(t,e,"").attr("font-size",s).attr("fill",i),null!=r&&h.attr("font-weight",r),h},s.prototype.resizeHandler=function(){return this.timeoutId=null,this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()},s}(Morris.EventEmitter),Morris.DonutSegment=function(i){function s(e,i,s,r,h,n,o,a,l,c){this.cx=e,this.cy=i,this.inner=s,this.outer=r,this.color=o,this.backgroundColor=a,this.index=l,this.raphael=c,this.deselect=t(this.deselect,this),this.select=t(this.select,this),this.sin_p0=Math.sin(h),this.cos_p0=Math.cos(h),this.sin_p1=Math.sin(n),this.cos_p1=Math.cos(n),this.is_long=n-h>Math.PI?1:0,this.path=this.calcSegment(this.inner+3,this.inner+this.outer-5),this.selectedPath=this.calcSegment(this.inner+3,this.inner+this.outer),this.hilight=this.calcArc(this.inner)}return e(s,i),s.prototype.calcArcPoints=function(t){return[this.cx+t*this.sin_p0,this.cy+t*this.cos_p0,this.cx+t*this.sin_p1,this.cy+t*this.cos_p1]},s.prototype.calcSegment=function(t,e){var i,s,r,h,n,o,a,l,c,u;return c=this.calcArcPoints(t),i=c[0],r=c[1],s=c[2],h=c[3],u=this.calcArcPoints(e),n=u[0],a=u[1],o=u[2],l=u[3],"M"+i+","+r+("A"+t+","+t+",0,"+this.is_long+",0,"+s+","+h)+("L"+o+","+l)+("A"+e+","+e+",0,"+this.is_long+",1,"+n+","+a)+"Z"},s.prototype.calcArc=function(t){var e,i,s,r,h;return h=this.calcArcPoints(t),e=h[0],s=h[1],i=h[2],r=h[3],"M"+e+","+s+("A"+t+","+t+",0,"+this.is_long+",0,"+i+","+r)},s.prototype.render=function(){return this.arc=this.drawDonutArc(this.hilight,this.color),this.seg=this.drawDonutSegment(this.path,this.color,this.backgroundColor,function(t){return function(){return t.fire("hover",t.index)}}(this),function(t){return function(){return t.fire("click",t.index)}}(this))},s.prototype.drawDonutArc=function(t,e){return this.raphael.path(t).attr({stroke:e,"stroke-width":2,opacity:0})},s.prototype.drawDonutSegment=function(t,e,i,s,r){return this.raphael.path(t).attr({fill:e,stroke:i,"stroke-width":3}).hover(s).click(r)},s.prototype.select=function(){return this.selected?void 0:(this.seg.animate({path:this.selectedPath},150,"<>"),this.arc.animate({opacity:1},150,"<>"),this.selected=!0)},s.prototype.deselect=function(){return this.selected?(this.seg.animate({path:this.path},150,"<>"),this.arc.animate({opacity:0},150,"<>"),this.selected=!1):void 0},s}(Morris.EventEmitter)}).call(this);