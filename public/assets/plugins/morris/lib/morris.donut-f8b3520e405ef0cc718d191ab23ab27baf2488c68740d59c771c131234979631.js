(function(){var c=function(t,e){return function(){return t.apply(e,arguments)}},i=function(t,e){function i(){this.constructor=t}for(var s in e)r.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},r={}.hasOwnProperty;Morris.Donut=function(t){function e(t){if(this.resizeHandler=c(this.resizeHandler,this),this.select=c(this.select,this),this.click=c(this.click,this),!(this instanceof Morris.Donut))return new Morris.Donut(t);if(this.options=$.extend({},this.defaults,t),"string"==typeof t.element?this.el=$(document.getElementById(t.element)):this.el=$(t.element),null===this.el||0===this.el.length)throw new Error("Graph placeholder not found.");var e;void 0!==t.data&&0!==t.data.length&&(this.raphael=new Raphael(this.el[0]),this.options.resize&&$(window).bind("resize",(e=this,function(){return null!=e.timeoutId&&window.clearTimeout(e.timeoutId),e.timeoutId=window.setTimeout(e.resizeHandler,100)})),this.setData(t.data))}return i(e,t),e.prototype.defaults={colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:Morris.commas,resize:!1},e.prototype.redraw=function(){var t,e,i,s,r,h,n,o,a,l,c,u,p,d,f,g,m,y,w,v,x,M;for(this.raphael.clear(),e=this.el.width()/2,i=this.el.height()/2,M=(Math.min(e,i)-10)/3,h=x=0,l=(g=this.values).length;h<l;h++)x+=g[h];for(d=5/(2*M),t=1.9999*Math.PI-d*this.data.length,r=a=0,this.segments=[],s=n=0,c=(m=this.values).length;n<c;s=++n)f=a+d+t*(m[s]/x),(v=new Morris.DonutSegment(e,i,2*M,M,a,f,this.data[s].color||this.options.colors[r%this.options.colors.length],this.options.backgroundColor,r,this.raphael)).render(),this.segments.push(v),v.on("hover",this.select),v.on("click",this.click),a=f,r+=1;for(this.text1=this.drawEmptyDonutLabel(e,i-10,this.options.labelColor,15,800),this.text2=this.drawEmptyDonutLabel(e,i+10,this.options.labelColor,14),p=Math.max.apply(Math,this.values),w=[],o=r=0,u=(y=this.values).length;o<u;o++){if(y[o]===p){this.select(r);break}w.push(r+=1)}return w},e.prototype.setData=function(t){var r;return this.data=t,this.values=function(){var t,e,i,s;for(s=[],t=0,e=(i=this.data).length;t<e;t++)r=i[t],s.push(parseFloat(r.value));return s}.call(this),this.redraw()},e.prototype.click=function(t){return this.fire("click",t,this.data[t])},e.prototype.select=function(t){var e,i,s,r;for(e=0,i=(s=this.segments).length;e<i;e++)s[e].deselect();return this.segments[t].select(),r=this.data[t],this.setLabels(r.label,this.options.formatter(r.value,r))},e.prototype.setLabels=function(t,e){var i,s,r,h,n,o,a,l;return h=1.8*(i=2*(Math.min(this.el.width()/2,this.el.height()/2)-10)/3),r=i/2,s=i/3,this.text1.attr({text:t,transform:""}),n=this.text1.getBBox(),o=Math.min(h/n.width,r/n.height),this.text1.attr({transform:"S"+o+","+o+","+(n.x+n.width/2)+","+(n.y+n.height)}),this.text2.attr({text:e,transform:""}),a=this.text2.getBBox(),l=Math.min(h/a.width,s/a.height),this.text2.attr({transform:"S"+l+","+l+","+(a.x+a.width/2)+","+a.y})},e.prototype.drawEmptyDonutLabel=function(t,e,i,s,r){var h;return h=this.raphael.text(t,e,"").attr("font-size",s).attr("fill",i),null!=r&&h.attr("font-weight",r),h},e.prototype.resizeHandler=function(){return this.timeoutId=null,this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()},e}(Morris.EventEmitter),Morris.DonutSegment=function(t){function e(t,e,i,s,r,h,n,o,a,l){this.cx=t,this.cy=e,this.inner=i,this.outer=s,this.color=n,this.backgroundColor=o,this.index=a,this.raphael=l,this.deselect=c(this.deselect,this),this.select=c(this.select,this),this.sin_p0=Math.sin(r),this.cos_p0=Math.cos(r),this.sin_p1=Math.sin(h),this.cos_p1=Math.cos(h),this.is_long=h-r>Math.PI?1:0,this.path=this.calcSegment(this.inner+3,this.inner+this.outer-5),this.selectedPath=this.calcSegment(this.inner+3,this.inner+this.outer),this.hilight=this.calcArc(this.inner)}return i(e,t),e.prototype.calcArcPoints=function(t){return[this.cx+t*this.sin_p0,this.cy+t*this.cos_p0,this.cx+t*this.sin_p1,this.cy+t*this.cos_p1]},e.prototype.calcSegment=function(t,e){var i,s,r,h,n,o,a,l,c,u;return i=(c=this.calcArcPoints(t))[0],r=c[1],s=c[2],h=c[3],n=(u=this.calcArcPoints(e))[0],a=u[1],o=u[2],l=u[3],"M"+i+","+r+"A"+t+","+t+",0,"+this.is_long+",0,"+s+","+h+"L"+o+","+l+"A"+e+","+e+",0,"+this.is_long+",1,"+n+","+a+"Z"},e.prototype.calcArc=function(t){var e,i,s,r,h;return e=(h=this.calcArcPoints(t))[0],s=h[1],i=h[2],r=h[3],"M"+e+","+s+"A"+t+","+t+",0,"+this.is_long+",0,"+i+","+r},e.prototype.render=function(){return this.arc=this.drawDonutArc(this.hilight,this.color),this.seg=this.drawDonutSegment(this.path,this.color,this.backgroundColor,(e=this,function(){return e.fire("hover",e.index)}),(t=this,function(){return t.fire("click",t.index)}));var t,e},e.prototype.drawDonutArc=function(t,e){return this.raphael.path(t).attr({stroke:e,"stroke-width":2,opacity:0})},e.prototype.drawDonutSegment=function(t,e,i,s,r){return this.raphael.path(t).attr({fill:e,stroke:i,"stroke-width":3}).hover(s).click(r)},e.prototype.select=function(){if(!this.selected)return this.seg.animate({path:this.selectedPath},150,"<>"),this.arc.animate({opacity:1},150,"<>"),this.selected=!0},e.prototype.deselect=function(){if(this.selected)return this.seg.animate({path:this.path},150,"<>"),this.arc.animate({opacity:0},150,"<>"),this.selected=!1},e}(Morris.EventEmitter)}).call(this);